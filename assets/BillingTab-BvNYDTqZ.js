import{r as a,h as o,j as e,G as g,Z as j,V as L,ar as O,k as D,C as $,a5 as z}from"./index-Cxmp2eWs.js";import{P as W}from"./plus-tnFknzSr.js";import{R as _}from"./settings-CfLDryEX.js";import{Q}from"./qr-code-Br7Ofnzm.js";const K=({schoolConfig:c})=>{const[V,S]=a.useState([]),[Y,P]=a.useState(null),[I,N]=a.useState(c.walletBalance||0),[U,w]=a.useState(!1),[A,x]=a.useState(!1),[n,u]=a.useState(""),[b,r]=a.useState("INIT"),[R,i]=a.useState(""),[l,E]=a.useState(null),[m,F]=a.useState(null),[h,G]=a.useState(""),[k,v]=a.useState(!1);a.useEffect(()=>{p()},[]);const p=async()=>{w(!0);const[t,s,d]=await Promise.all([o.getWalletHistory(),o.getWalletAnalytics(),o.getGlobalSettings()]);if(S(t),P(s),d.GPAY_CONFIG)try{E(JSON.parse(d.GPAY_CONFIG))}catch{}const C=await o.getSchoolConfig();C&&N(C.walletBalance||0),w(!1)},M=async()=>{if(!n)return;const t=parseInt(n);if(t<50){i("Minimum purchase is 50 Credits");return}r("PROCESSING"),i("");try{const s=await o.initializePayment(t,c.phone||"9999999999",c.schoolName,c.adminEmail);if(s.success){const d=await o.rechargeWallet(t,"Credit Pack Purchase",s.transactionId);d.success?(N(d.newBalance),r("SUCCESS"),p()):(i(d.message||"Payment Successful but Credit Update Failed."),r("FAILED"))}else s.gateway==="MANUAL"?r("MANUAL_VIEW"):(i(s.message||"Transaction Failed"),r("FAILED"))}catch(s){i(s.message||"Unknown error"),r("FAILED")}},T=async()=>{if(!m||!h)return alert("Please select file and enter UTR.");v(!0);const t=await o.submitPaymentProof(parseInt(n),h,m,"CREDIT_PURCHASE");v(!1),t.success?(alert("Proof Submitted! Credits will be added after verification."),x(!1)):alert("Upload Failed: "+t.message)},B=t=>l!=null&&l.vpa?`upi://pay?pa=${l.vpa}&pn=${encodeURIComponent("ResultMate Services")}&am=${t}&tn=${encodeURIComponent("Ref: "+c.id.substring(0,6))}&cu=INR`:"#",f=({amount:t,bonus:s,popular:d})=>e.jsxs("button",{onClick:()=>u(t.toString()),className:`relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all ${n===t.toString()?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:border-blue-300"}`,children:[d&&e.jsx("div",{className:"absolute -top-3 bg-blue-600 text-white text-[9px] font-bold px-2 py-0.5 rounded-full uppercase",children:"Most Popular"}),e.jsx("div",{className:`p-2 rounded-full mb-2 ${n===t.toString()?"bg-blue-100 text-blue-600":"bg-slate-100 dark:bg-slate-700 text-slate-400"}`,children:e.jsx(j,{className:"w-5 h-5 fill-current"})}),e.jsx("div",{className:"text-lg font-black text-slate-800 dark:text-white",children:t}),e.jsx("div",{className:"text-[10px] text-slate-500 font-bold uppercase mb-1",children:"Credits"}),e.jsxs("div",{className:"text-xs font-bold text-slate-600 dark:text-slate-400",children:["₹",t]}),s&&e.jsxs("div",{className:"text-[9px] text-green-600 font-bold mt-1",children:["+",s," Free"]})]}),y=()=>e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl text-left border border-slate-200 dark:border-slate-700 animate-fade-in-up",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-blue-600 mb-2 flex items-center justify-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"})," Google Pay / UPI"]}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Send ",e.jsxs("b",{children:["₹",n]})," to ",e.jsx("b",{children:(l==null?void 0:l.vpa)||"Not Configured"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-lg border border-slate-200 dark:border-slate-700 mb-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-1",children:"Step 1: Pay using App"}),e.jsx("a",{href:B(n),className:"block w-full bg-blue-600 text-white text-center py-2 rounded text-xs font-bold hover:bg-blue-700 transition-colors",children:"Click to Open GPay / PhonePe"}),e.jsx("p",{className:"text-[10px] text-center mt-2 text-slate-400",children:"Or scan QR code if available."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-2",children:"Step 2: Upload Proof"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded p-2 text-xs",placeholder:"Enter UPI Ref No / UTR",value:h,onChange:t=>G(t.target.value)}),e.jsxs("label",{className:"block w-full border-2 border-dashed border-slate-300 dark:border-slate-600 rounded p-2 text-center text-xs text-slate-500 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[m?m.name:e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4 mx-auto mb-1"})," Upload Screenshot"]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:t=>{var s;return F(((s=t.target.files)==null?void 0:s[0])||null)}})]}),e.jsx("button",{onClick:T,disabled:k,className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded text-xs font-bold",children:k?"Uploading...":"Submit Proof"})]})]})]});return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(g,{className:"bg-gradient-to-br from-slate-900 to-indigo-900 text-white relative overflow-hidden flex flex-col justify-between min-h-[220px]",children:[e.jsx("div",{className:"absolute top-0 right-0 p-6 opacity-10",children:e.jsx(j,{className:"w-40 h-40 fill-white"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 uppercase tracking-wider mb-1",children:"Feature Credits"}),e.jsxs("h2",{className:"text-5xl font-black tracking-tight flex items-baseline gap-1",children:[I," ",e.jsx("span",{className:"text-lg font-bold text-slate-400",children:"CR"})]})]}),e.jsx("div",{className:"bg-white/10 p-2 rounded-lg backdrop-blur-md border border-white/10",children:e.jsx(j,{className:"w-6 h-6 text-yellow-400 fill-yellow-400"})})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Use these credits for Result Publishing, AI & SMS."})]}),e.jsxs("div",{className:"relative z-10 mt-6 pt-6 border-t border-white/10 flex gap-3",children:[e.jsxs("button",{onClick:()=>{x(!0),r("INIT"),u(""),i("")},className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-blue-900/30 flex items-center justify-center gap-2 transition-all",children:[e.jsx(W,{className:"w-4 h-4"})," Buy Credits"]}),e.jsx("button",{onClick:p,className:"bg-white/10 hover:bg-white/20 text-white p-3 rounded-xl transition-all",children:e.jsx(_,{className:`w-5 h-5 ${U?"animate-spin":""}`})})]})]}),e.jsxs(g,{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"})," Current Plan"]}),e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold uppercase",children:"Pay As You Go"})]}),e.jsxs("div",{className:"space-y-3 relative z-10 text-sm flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-green-50 dark:bg-green-900/10 border border-green-100 dark:border-green-800/30",children:[e.jsxs("span",{className:"text-slate-700 dark:text-slate-200 font-bold flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-green-600"})," 50 Credits Bonus"]}),e.jsx("span",{className:"font-bold text-green-600 text-xs",children:"ONE-TIME"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"Result Publishing"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-xs",children:"1 Credit / student"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"AI Question Gen"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-xs",children:"5 Credits / request"})]})]})]})]}),A&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(g,{className:"w-full max-w-md relative overflow-hidden bg-white dark:bg-slate-900 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>x(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600 font-bold",children:"✕"}),b==="INIT"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Credit Store"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Choose a pack to top up."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(f,{amount:100}),e.jsx(f,{amount:500,popular:!0}),e.jsx(f,{amount:1e3,bonus:100})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Or Enter Custom Amount"}),e.jsx("input",{type:"number",className:"w-full pl-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg font-bold text-slate-800 dark:text-white",placeholder:"50+",value:n,onChange:t=>u(t.target.value)})]}),e.jsx("button",{onClick:M,className:"w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-xl rounded-xl font-bold",children:"Buy Credits"})]}),b==="MANUAL_VIEW"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Payment Options"})}),l&&l.vpa?e.jsx(y,{}):e.jsx("div",{className:"text-center p-4 text-slate-500",children:"Admin hasn't configured manual payments. Contact support."}),e.jsx("button",{onClick:()=>r("INIT"),className:"w-full mt-4 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl font-bold text-sm",children:"Back"})]}),b==="FAILED"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(D,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"font-bold text-xl text-slate-800 dark:text-white",children:"Payment Failed"}),e.jsx("p",{className:"text-sm text-red-500 mt-2 font-bold mb-6",children:R}),l&&l.vpa&&e.jsx(y,{}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>x(!1),className:"flex-1 py-3 text-slate-500 font-bold text-sm bg-slate-100 dark:bg-slate-800 rounded-xl",children:"Close"}),e.jsx("button",{onClick:()=>r("INIT"),className:"flex-1 py-3 bg-slate-900 text-white rounded-xl font-bold text-sm",children:"Retry"})]})]}),b==="SUCCESS"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"font-bold text-2xl text-slate-900 dark:text-white",children:"Success!"}),e.jsx("p",{className:"text-slate-500 mt-2 mb-6",children:"Credits added to wallet."}),e.jsx("button",{onClick:()=>x(!1),className:"bg-green-600 text-white px-6 py-2 rounded-full font-bold",children:"Done"})]})]})})]})};export{K as default};
