import{c as T,r as a,h as n,j as e,v as U,ap as H,U as G,F as q,R as E,a as V,f as Y,G as W,Z as _,b as D,d as M,ai as Z}from"./index-Cxmp2eWs.js";import{P as J}from"./plus-tnFknzSr.js";import{C as Q,a as K}from"./clipboard-check-B53NFhBN.js";import{I as X}from"./DashboardAdmin-DnpYVWKl.js";import"./settings-CfLDryEX.js";import"./layout-dashboard-B557jvRe.js";import"./clipboard-list-B39n2P9h.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=T("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=T("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]),xe=({setActiveTab:i,classes:w,pendingAdmissions:p,onRefresh:b,setShowPublishModal:te,setShowStudentEntryModal:I})=>{const[l,A]=a.useState(null),[o,N]=a.useState(0),[u,O]=a.useState(0),[L,f]=a.useState(!1),[B,c]=a.useState(!1),[x,k]=a.useState("TERM"),[y,v]=a.useState(""),[h,C]=a.useState(""),[j,g]=a.useState(!1);a.useEffect(()=>{S()},[]),a.useEffect(()=>{const s=w.reduce((t,d)=>t+(d.studentCount||0),0);O(s)},[w]);const S=async()=>{const[s,t]=await Promise.all([n.getHolidayRadar(),n.getSchoolConfig()]);A(s),t&&(N(t.walletBalance||0),f(!!t.scheduledPublishDate))},R=async(s,t)=>{if(t==="APPROVE"){const d=await n.verifyStudent(s,"Admin");d.success?b():alert(d.message)}else{if(!window.confirm("Reject this admission?"))return;(await n.rejectAdmission(s)).success&&b()}},$=()=>{c(!0);const s=new Date;s.setMinutes(s.getMinutes()-s.getTimezoneOffset()),v(s.toISOString().slice(0,16));const t=new Date;t.setDate(t.getDate()+30),t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),C(t.toISOString().slice(0,16))},F=async()=>{if(!confirm("Are you sure? Results will be hidden from public immediately."))return;g(!0);const s=await n.updateSchoolSettings({scheduledPublishDate:null});g(!1),s.success?(alert("Results Unpublished."),f(!1),c(!1),b()):alert("Failed to unpublish.")},z=async()=>{var P;if(!["CLASS_TEST","REVISION"].includes(x)){const m=u*1;if(o<m){alert(`Insufficient Balance!

Required: ${m} CR
Available: ${o} CR

Please recharge to publish.`),i("billing");return}if(!confirm(`Publishing Term Results for ${u} students.

Estimated Cost: ${m} Credits.

Proceed?`))return}g(!0);const t=y||new Date(Date.now()-6e4).toISOString(),d=h?new Date(h).toISOString():void 0;await n.updateSchoolSettings({resultExpiryDate:d});const r=await n.publishResultWithPayment(x,t);if(g(!1),r.success){c(!1);const m=r.cost&&r.cost>0?` (${r.cost} Credits Deducted)`:" (Free Tier)";alert(`ðŸš€ Results Published Successfully!${m}

Visible until: ${h?new Date(h).toLocaleDateString():"Forever"}`),b(),f(!0),r.newBalance!==void 0?N(r.newBalance):S()}else(P=r.message)!=null&&P.includes("Insufficient Credits")?confirm(`Low Balance detected by Server.

Go to Recharge page?`)&&(i("billing"),c(!1)):alert("Publish Failed: "+r.message)};return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[o<20&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-4 rounded-xl flex items-center justify-between animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-6 h-6 text-red-600"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-red-800 dark:text-red-200 text-sm",children:["Low Balance: ",o," Credits"]}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-300",children:"Result publishing may be blocked."})]})]}),e.jsx("button",{onClick:()=>i("billing"),className:"bg-red-600 text-white px-4 py-2 rounded-lg text-xs font-bold shadow-lg hover:bg-red-700",children:"Recharge Now"})]}),l&&e.jsxs("div",{className:`p-4 rounded-xl border-l-4 shadow-lg flex items-center justify-between ${l.type==="HOLIDAY"?"bg-red-50 dark:bg-red-900/20 border-red-500":"bg-indigo-50 dark:bg-indigo-900/20 border-indigo-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${l.type==="HOLIDAY"?"bg-red-100 text-red-600":"bg-indigo-100 text-indigo-600"}`,children:l.type==="HOLIDAY"?e.jsx(ee,{className:"w-5 h-5 animate-bounce"}):e.jsx(H,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-bold text-sm ${l.type==="HOLIDAY"?"text-red-800 dark:text-red-200":"text-indigo-800 dark:text-indigo-200"}`,children:l.message}),e.jsxs("p",{className:"text-[10px] opacity-70 flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"})," Radar Confidence: ",l.confidence,"% â€¢ Region: ",l.region]})]})]}),l.type==="HOLIDAY"&&e.jsx("button",{onClick:()=>i("calendar"),className:"text-xs bg-white dark:bg-slate-800 px-3 py-1.5 rounded-lg font-bold text-red-600 hover:bg-red-50 dark:hover:bg-slate-700 transition-colors shadow-sm",children:"Update Calendar"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>i("classes"),className:"bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-5 rounded-2xl shadow-lg shadow-blue-500/20 text-left transition-transform hover:-translate-y-1",children:[e.jsx("div",{className:"bg-white/20 w-10 h-10 rounded-lg flex items-center justify-center mb-3",children:e.jsx(J,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"font-bold text-lg leading-none mb-1",children:"Add Class"}),e.jsx("p",{className:"text-blue-100 text-xs opacity-80",children:"Step 1: Create"})]}),e.jsxs("button",{onClick:()=>I(!0),className:"bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 text-left transition-transform hover:-translate-y-1",children:[e.jsx("div",{className:"bg-orange-100 dark:bg-orange-900/30 w-10 h-10 rounded-lg flex items-center justify-center mb-3",children:e.jsx(G,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-none mb-1",children:"Add Students"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Step 2: Quick Entry"})]}),e.jsxs("button",{onClick:()=>i("settings"),className:"bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 text-left transition-transform hover:-translate-y-1",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 w-10 h-10 rounded-lg flex items-center justify-center mb-3",children:e.jsx(q,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-none mb-1",children:"Exam Name"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Step 3: Configure"})]}),e.jsxs("button",{onClick:$,className:"bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white p-5 rounded-2xl shadow-lg shadow-green-500/20 text-left transition-transform hover:-translate-y-1",children:[e.jsx("div",{className:"bg-white/20 w-10 h-10 rounded-lg flex items-center justify-center mb-3",children:e.jsx(E,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"font-bold text-lg leading-none mb-1",children:"Publish Result"}),e.jsx("p",{className:"text-green-100 text-xs opacity-80",children:"Final Step: Go Live"})]})]}),p.length>0&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl p-4 animate-pulse",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"w-5 h-5"})," Pending Admissions (",p.length,")"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2 max-h-60 overflow-y-auto",children:p.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg flex justify-between items-center shadow-sm border border-slate-100",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-sm",children:s.name}),e.jsx("span",{className:"text-[10px] bg-slate-100 px-1 rounded",children:s.className})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[s.gender,", ",Y(s.dob)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>R(s.id,"APPROVE"),className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded font-bold hover:bg-green-200",children:"Approve"}),e.jsx("button",{onClick:()=>R(s.id,"REJECT"),className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded font-bold hover:bg-red-200",children:"Reject"})]})]},s.id))})]}),B&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(W,{className:"max-w-md w-full relative border-t-4 border-emerald-600 bg-white dark:bg-slate-900",children:[e.jsx("button",{onClick:()=>c(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600",children:"âœ•"}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-emerald-50 dark:bg-emerald-900/20 rounded-full flex items-center justify-center mx-auto mb-4 border border-emerald-100 dark:border-emerald-800",children:e.jsx(E,{className:"w-8 h-8 text-emerald-600"})}),e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Publish Results"}),e.jsx("p",{className:"text-slate-500 text-sm",children:"Make marks visible to parents & students."})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-2",children:"Select Exam Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>k("TERM"),className:`p-3 rounded-lg border-2 text-sm font-bold flex flex-col items-center gap-1 transition-all ${x==="TERM"?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-slate-200 text-slate-500 hover:bg-slate-50"}`,children:[e.jsx(Q,{className:"w-5 h-5"}),"Term / Final",e.jsxs("span",{className:"text-[9px] font-normal text-orange-600 bg-orange-100 px-1 rounded flex items-center gap-1 mt-1",children:[e.jsx(_,{className:"w-3 h-3 fill-orange-600"})," 1 Credit/Student"]})]}),e.jsxs("button",{onClick:()=>k("CLASS_TEST"),className:`p-3 rounded-lg border-2 text-sm font-bold flex flex-col items-center gap-1 transition-all ${x==="CLASS_TEST"?"border-blue-500 bg-blue-50 text-blue-700":"border-slate-200 text-slate-500 hover:bg-slate-50"}`,children:[e.jsx(K,{className:"w-5 h-5"}),"Class Test",e.jsx("span",{className:"text-[9px] font-normal text-green-600 bg-green-100 px-1 rounded mt-1",children:"FREE"})]})]})]}),x==="TERM"&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg flex items-start gap-2 border border-blue-100 dark:border-blue-800",children:[e.jsx(X,{className:"w-4 h-4 text-blue-600 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:"Wallet Check"}),e.jsxs("p",{className:"text-[10px] text-blue-600 dark:text-blue-400 leading-tight mt-1",children:["Students: ",u," | Cost: ",u," CR | Bal: ",o," CR"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Publish Time"}),e.jsx(D,{type:"datetime-local",value:y,onChange:s=>v(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Visible Until (Expiry)"}),e.jsx(D,{type:"datetime-local",value:h,onChange:s=>C(s.target.value)})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[L&&e.jsxs(M,{onClick:F,disabled:j,className:"flex-1 bg-red-100 text-red-600 hover:bg-red-200 flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"})," Unpublish"]}),e.jsx(M,{onClick:z,disabled:j,className:"flex-[2] bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-900/20",children:j?"Processing...":"Confirm & Publish"})]})]})})]})};export{xe as default};
