import{c as ee,r as t,j as e,G as O,U as je,S as Ke,C as es,L as Be,a as W,b as Ie,d as E,e as q,f as ss,g as Fe,X as Ue,h as Oe,i as c,A as ts,R as as,M as ls,k as rs,B as _e,l as He,m as ns,n as Ye,o as Ge,u as ds,p as os,H as cs,F as is,Z as xs,W as ms}from"./index-BrKrnA6c.js";import hs from"./ExamsTab-DmQ5XdIi.js";import{P as us}from"./printer-C1c7wJH-.js";import{T as qe}from"./trash-2-C9Kol0Sc.js";import{P as ps,S as bs,M as gs,T as fs,a as js}from"./thumbs-up-y9rNYX20.js";import{A as Ns}from"./arrow-right-left-sbcIP7dl.js";import{C as ze}from"./calendar-days-DptCJbCe.js";import{S as Ve}from"./save-BZhAWSHs.js";import{P as ws}from"./plus-CJ_oATs7.js";import{F as vs}from"./frown--oBTdfKY.js";import{B as $e}from"./bell-BrTZ_tGK.js";import{L as ks}from"./layout-grid-BMCKXiJh.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ee("ClipboardCheck",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=ee("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=ee("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=ee("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=ee("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),As=({user:d,students:b,pendingAdmissions:x,stats:j,sortingMethod:m,onRefresh:p,onDeleteStudent:C,onAdmissionAction:v,onCleanJunk:N})=>{const[h,k]=t.useState(!1),[o,i]=t.useState({regNo:"",rollNo:"",name:"",dob:"",gender:"",fatherName:"",motherName:"",photoUrl:""}),[L,T]=t.useState(!1),[F,R]=t.useState({name:!1,dob:!1,gender:!1}),[A,P]=t.useState(""),[_,g]=t.useState(""),[r,l]=t.useState(!1),[n,u]=t.useState(!1),[M,B]=t.useState(!1),[re,Je]=t.useState("UPLOAD"),[Ne,Ze]=t.useState(null),[we,ve]=t.useState([]),[ke,ne]=t.useState([]),[ye,Se]=t.useState(!1),[Ce,Te]=t.useState([]),[Ae,de]=t.useState(0),[oe,Ee]=t.useState({name:"",regNo:"",rollNo:"",gender:"",dob:"",phone:"",fatherName:"",motherName:"",address:""}),[U,K]=t.useState(null),[V,se]=t.useState(!1),[f,H]=t.useState({}),[J,te]=t.useState(""),[ce,ie]=t.useState([]),[z,ae]=t.useState(!1),G=d.submissionStatus==="SUBMITTED"||d.submissionStatus==="APPROVED";t.useEffect(()=>{(async()=>{const y=await c.getClasses();ie(y.filter(S=>S.id!==d.id))})()},[d.id]);const xe=t.useMemo(()=>{const s=m||"BOYS_FIRST";if(s==="BOYS_FIRST"||s==="GIRLS_FIRST"){const y=b.filter(I=>I.gender==="Male").sort((I,D)=>(I.rollNo||9999)-(D.rollNo||9999)),S=b.filter(I=>I.gender!=="Male").sort((I,D)=>(I.rollNo||9999)-(D.rollNo||9999));return s==="BOYS_FIRST"?[...y,...S]:[...S,...y]}return[...b].sort((y,S)=>s==="ROLL_ONLY"?(y.rollNo||9999)-(S.rollNo||9999):s==="NAME_ONLY"?y.name.localeCompare(S.name):0)},[b,m]),me=s=>{o[s]?R(y=>({...y,[s]:!1})):R(y=>({...y,[s]:!0}))},he=async s=>{if(!s.target.files||!s.target.files[0])return;if(!d.isPro){alert("Photo upload is an Elite/Pro feature.");return}u(!0);const y=s.target.files[0],S=await c.uploadImage(y,"students");u(!1),S.success&&S.publicUrl?(i(I=>({...I,photoUrl:S.publicUrl})),l(!1)):alert("Upload failed: "+S.message)},ue=async s=>{if(s.preventDefault(),G){alert("Class is locked/submitted. Ask admin to unlock before adding students.");return}g(""),P(""),R({name:!1,dob:!1,gender:!1});let y=!1;if(o.name||(R(D=>({...D,name:!0})),y=!0),o.dob||(R(D=>({...D,dob:!0})),y=!0),o.gender||(R(D=>({...D,gender:!0})),y=!0),y){g("âš ï¸ Please fill Name, DOB & Gender!");return}T(!0);const S={...o,fatherName:o.fatherName||"Not Entered",motherName:o.motherName||"Not Entered",addedBy:d.teacherName||"Class Teacher"};if(!S.photoUrl){const D=S.name||"Felix";S.photoUrl=`https://api.dicebear.com/7.x/avataaars/svg?seed=${D}&gender=${S.gender==="Female"?"female":"male"}`}const I=await c.createStudent(d.id,S);T(!1),I.success?(P(`âœ… ${o.name} Added!`),i({regNo:"",rollNo:"",name:"",dob:"",gender:"",fatherName:"",motherName:"",photoUrl:""}),p(),setTimeout(()=>P(""),2500)):alert("Failed: "+I.message)},pe=s=>{K(s),H({...s}),se(!1),te("")},be=async()=>{if(G)return alert("Class is locked.");await c.updateStudentDetails(U.id,f),v(U.id,"APPROVE"),le(null)},ge=async()=>{if(!J||!U)return;ae(!0);const s=await c.transferStudentAdmission(U.id,J);ae(!1),s.success?(alert("Student Transferred Successfully!"),K(null),p()):alert("Transfer failed: "+s.message)},le=s=>{K(s),se(!1),H({})},Z=`${window.location.href.split("#")[0]}#/register?schoolId=${d.schoolId}&classId=${d.id}`,Me=`Dear Parents,

Admission for *${d.name}* is now open.
Please register your child using the link below:

ðŸ”— ${Z}

Thank you,
${d.teacherName||"Class Teacher"}`;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in-up",children:[e.jsxs("div",{className:"md:col-span-1 space-y-6",children:[e.jsxs(O,{className:"bg-gradient-to-br from-indigo-600 to-purple-700 text-white border-none relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-20",children:e.jsx(je,{className:"w-24 h-24"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Smart Invite"}),e.jsx("p",{className:"text-xs text-indigo-200 mb-4",children:"Share this link with parents for self-registration."}),e.jsx("div",{className:"bg-black/20 p-2 rounded-lg text-[10px] font-mono mb-4 break-all truncate border border-white/10 select-all cursor-pointer",onClick:()=>navigator.clipboard.writeText(Z),children:Z}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>window.open(`https://wa.me/?text=${encodeURIComponent(Me)}`,"_blank"),className:"flex-1 bg-[#25D366] hover:bg-[#20bd5a] text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1 shadow-lg transition-transform hover:scale-105",children:[e.jsx(Ke,{className:"w-4 h-4"})," WhatsApp"]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(Z),alert("Link copied!")},className:"flex-1 bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1 transition-transform hover:scale-105",children:[e.jsx(es,{className:"w-4 h-4"})," Copy"]})]})]}),e.jsxs(O,{className:`border-t-4 ${G?"border-t-slate-400 opacity-80":"border-t-blue-500"} relative overflow-hidden`,children:[G&&e.jsxs("div",{className:"absolute inset-0 bg-white/60 dark:bg-slate-950/60 backdrop-blur-[1px] z-10 flex flex-col items-center justify-center text-center",children:[e.jsx(Be,{className:"w-8 h-8 text-slate-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold text-slate-600 dark:text-slate-300",children:"Class Locked"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Results submitted. Cannot add students."})]}),A&&e.jsxs("div",{className:"absolute inset-0 z-20 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(W,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:A})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(Ie,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Add Student"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Manual Entry"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"mb-4 flex gap-4 items-center bg-slate-50 dark:bg-slate-900 p-3 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"relative w-16 h-16 shrink-0 rounded-full overflow-hidden border-2 border-slate-200 shadow-sm",children:o.photoUrl?e.jsx("img",{src:o.photoUrl,className:"w-full h-full object-cover"}):e.jsx("img",{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${o.name||"Felix"}&gender=${o.gender==="Female"?"female":"male"}`,className:"w-full h-full opacity-80"})}),e.jsx("div",{className:"flex-1 space-y-2",children:r?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("label",{className:"cursor-pointer bg-slate-200 dark:bg-slate-700 px-3 py-1 rounded text-[10px] font-bold text-center block",children:[n?"Uploading...":"Choose File",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:he,disabled:n})]}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"text-[10px] text-red-500",children:"Cancel"})]}):e.jsxs("div",{children:[e.jsx(E,{className:"text-xs h-8",placeholder:"Paste Image URL...",value:o.photoUrl,onChange:s=>i({...o,photoUrl:s.target.value})}),d.isPro&&e.jsx("button",{type:"button",onClick:()=>l(!0),className:"text-[10px] text-blue-600 font-bold underline mt-1 block",children:"Or Upload File"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"FULL NAME *"}),e.jsx("input",{value:o.name,onChange:s=>i({...o,name:s.target.value.toUpperCase()}),onBlur:()=>me("name"),className:`w-full bg-white dark:bg-slate-800 font-bold rounded-lg px-4 py-2.5 outline-none border-2 ${F.name?"border-red-500":"border-slate-300 dark:border-slate-600"}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"Gender *"}),e.jsxs("select",{className:"w-full bg-white dark:bg-slate-800 px-3 py-2.5 outline-none font-medium border-2 rounded-lg",value:o.gender,onChange:s=>i({...o,gender:s.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"DOB *"}),e.jsx("input",{type:"date",value:o.dob,onChange:s=>i({...o,dob:s.target.value}),className:`w-full bg-white dark:bg-slate-800 font-medium rounded-lg px-3 py-2 outline-none border-2 ${F.dob?"border-red-500":"border-slate-300 dark:border-slate-600"}`})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(E,{className:"text-sm font-mono",placeholder:"Admission No (Reg)",value:o.regNo,onChange:s=>i({...o,regNo:s.target.value})}),e.jsx(E,{type:"number",className:"text-sm font-mono",placeholder:"Roll No",value:o.rollNo,onChange:s=>i({...o,rollNo:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(E,{className:"text-sm",placeholder:"Father",value:o.fatherName,onChange:s=>i({...o,fatherName:s.target.value})}),e.jsx(E,{className:"text-sm",placeholder:"Mother",value:o.motherName,onChange:s=>i({...o,motherName:s.target.value})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(q,{onClick:ue,disabled:L,className:"w-full py-3 text-sm font-bold",children:L?"Saving...":"Save & Add Next"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[x.length>0&&e.jsxs(O,{className:"bg-orange-50 dark:bg-orange-900/10 border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"})," Pending Admissions (",x.length,")"]}),e.jsx("span",{className:"text-[10px] bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 px-2 py-1 rounded",children:"Action Required"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3 max-h-64 overflow-y-auto pr-1 custom-scrollbar",children:x.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800 flex items-center justify-between group hover:border-orange-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.photoUrl||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.name}`,className:"w-10 h-10 rounded-full object-cover bg-slate-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-slate-800 dark:text-white",children:s.name}),e.jsxs("p",{className:"text-[10px] text-slate-500",children:["Applied: ",new Date().toLocaleDateString()]})]})]}),e.jsx("button",{onClick:()=>pe(s),className:"bg-white dark:bg-slate-800 border border-blue-200 dark:border-blue-800 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-blue-50 dark:hover:bg-blue-900/30 transition-colors",children:"Review"})]},s.id))})]}),e.jsxs(O,{className:"p-0 overflow-hidden min-h-[400px] relative",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-blue-500"})," Class List (",b.length,")"]}),e.jsxs(q,{variant:"secondary",onClick:()=>k(!0),className:"text-xs flex items-center gap-1",disabled:G,children:[e.jsx(us,{className:"w-3 h-3"})," Register"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-10",children:"Roll"}),e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3 w-24",children:"Reg No"}),e.jsx("th",{className:"p-3 w-24",children:"DOB"}),e.jsx("th",{className:"p-3 w-20 text-center",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:xe.map(s=>e.jsxs("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-center text-slate-500",children:s.rollNo||"-"}),e.jsx("td",{className:"p-3 text-slate-800 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2 font-bold",children:[s.photoUrl&&e.jsx("img",{src:s.photoUrl,className:"w-6 h-6 rounded-full object-cover"}),s.name,s.isPremium&&e.jsx(ss,{className:"w-3 h-3 text-yellow-500"})]})}),e.jsx("td",{className:"p-3 font-mono text-slate-600 dark:text-slate-300",children:s.regNo}),e.jsx("td",{className:"p-3 text-slate-500 font-mono",children:Fe(s.dob)}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{onClick:()=>C(s.id,s.name),disabled:G,className:"p-2 text-slate-400 hover:text-red-500 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(qe,{className:"w-4 h-4"})})})]},s.id))})]})})]})]}),U&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(O,{className:"w-full max-w-2xl bg-white dark:bg-slate-900 border-t-4 border-t-blue-600 max-h-[90vh] overflow-y-auto flex flex-col p-0",children:[e.jsxs("div",{className:"p-6 pb-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-950",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Review Application"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Verify details before approving."})]}),e.jsx("button",{onClick:()=>le(null),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(Ue,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("div",{className:"p-6 grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("img",{src:U.photoUrl||`https://api.dicebear.com/7.x/avataaars/svg?seed=${U.name}`,className:"w-32 h-32 rounded-full object-cover mx-auto border-4 border-white dark:border-slate-800 shadow-lg bg-slate-100"}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Applicant Photo"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-900/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm",children:"Student Details"}),e.jsxs("button",{onClick:()=>se(!V),className:"text-xs text-blue-600 underline flex items-center gap-1",children:[e.jsx(ps,{className:"w-3 h-3"})," ",V?"Cancel Edit":"Edit"]})]}),e.jsx("div",{className:"space-y-2 text-sm",children:V?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-8 text-xs",value:f.name,onChange:s=>H({...f,name:s.target.value.toUpperCase()}),placeholder:"Name"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(E,{className:"h-8 text-xs",value:f.regNo,onChange:s=>H({...f,regNo:s.target.value}),placeholder:"Reg No"}),e.jsx("input",{type:"date",className:"h-8 text-xs bg-white dark:bg-slate-800 border rounded px-2 w-full",value:f.dob,onChange:s=>H({...f,dob:s.target.value})})]}),e.jsxs("select",{className:"h-8 text-xs bg-white dark:bg-slate-800 border rounded px-2 w-full",value:f.gender,onChange:s=>H({...f,gender:s.target.value}),children:[e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Name:"})," ",e.jsx("span",{className:"font-bold",children:f.name})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Reg No:"})," ",e.jsx("span",{className:"font-mono",children:f.regNo||"-"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"DOB:"})," ",e.jsx("span",{children:Fe(f.dob)})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Gender:"})," ",e.jsx("span",{children:f.gender})]})]})})]})]}),e.jsxs("div",{className:"space-y-6 flex flex-col h-full",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("h4",{className:"font-bold text-slate-700 dark:text-slate-300 text-sm mb-3",children:"Parent Information"}),e.jsx("div",{className:"space-y-2 text-sm",children:V?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-8 text-xs",value:f.fatherName,onChange:s=>H({...f,fatherName:s.target.value}),placeholder:"Father's Name"}),e.jsx(E,{className:"h-8 text-xs",value:f.motherName,onChange:s=>H({...f,motherName:s.target.value}),placeholder:"Mother's Name"}),e.jsx(E,{className:"h-8 text-xs",value:f.phone,onChange:s=>H({...f,phone:s.target.value}),placeholder:"Phone"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Father:"})," ",e.jsx("span",{className:"font-bold",children:f.fatherName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Mother:"})," ",e.jsx("span",{children:f.motherName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Phone:"})," ",e.jsx("span",{children:f.phone})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Address:"})," ",e.jsx("span",{className:"text-xs",children:f.address||"-"})]})]})})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Wrong Class? Transfer Request"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Oe,{className:"h-9 text-xs py-0",value:J,onChange:s=>te(s.target.value),children:[e.jsx("option",{value:"",children:"Select Target Class"}),ce.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:ge,disabled:!J||z,className:"bg-purple-100 text-purple-700 px-3 rounded-lg text-xs font-bold hover:bg-purple-200 transition-colors whitespace-nowrap",children:z?"Moving...":e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"w-3 h-3 inline mr-1"})," Move"]})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>v(U.id,"REJECT"),className:"flex-1 py-3 border border-red-200 text-red-600 rounded-xl font-bold text-sm hover:bg-red-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"})," Reject"]}),e.jsxs("button",{onClick:be,disabled:G,className:"flex-[2] py-3 bg-green-600 text-white rounded-xl font-bold text-sm hover:bg-green-700 shadow-lg shadow-green-500/30 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(W,{className:"w-4 h-4"})," Approve Admission"]})]})]})]})]})]})})]})},Es=({students:d,marks:b,subjects:x,isSubmitted:j,loading:m,onMarkChange:p,onSaveAll:C,onSubmitResults:v})=>{const N=[...d].sort((g,r)=>(g.rollNo||9999)-(r.rollNo||9999)),[h,k]=t.useState("TERM"),[o,i]=t.useState(!1),[L,T]=t.useState(!1),[F,R]=t.useState(null);t.useEffect(()=>{(async()=>{const r=await c.getSchoolConfig();r!=null&&r.allowTeacherDirectPublish&&i(!0)})()},[]);const A=["CLASS_TEST","REVISION"].includes(h),P=async()=>{if(A&&o){if(!confirm(`Directly publish ${h} results? Parents will see this immediately.`))return;T(!0),v()}else v()},_=(g,r,l)=>{if(R(null),l===""||l.toUpperCase()==="AB"||l.toUpperCase()==="A"){p(g,r,l);return}const n=parseFloat(l);if(isNaN(n))return;const u=x.find(M=>M.name===r);if(u){if(n>u.maxMarks){R(`Cannot enter ${n} for ${r}. Max is ${u.maxMarks}.`);return}if(n<0)return}p(g,r,l)};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm relative",children:[F&&e.jsxs("div",{className:"absolute top-full left-0 right-0 bg-red-100 text-red-700 text-xs font-bold p-2 text-center border-b border-red-200 z-20 animate-fade-in-up",children:[e.jsx(ts,{className:"w-3 h-3 inline mr-1"})," ",F]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Assessment Type"}),e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>k("TERM"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${h==="TERM"?"bg-white dark:bg-slate-800 text-blue-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(ze,{className:"w-4 h-4"})," Term Exam"]}),e.jsxs("button",{onClick:()=>k("CLASS_TEST"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${h==="CLASS_TEST"?"bg-white dark:bg-slate-800 text-purple-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(We,{className:"w-4 h-4"})," Class Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white hidden md:block",children:"Marks Entry"}),j&&e.jsxs("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded font-bold flex items-center gap-1",children:[e.jsx(Be,{className:"w-3 h-3"})," Locked"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(q,{onClick:C,variant:"secondary",disabled:m||j,className:"flex-1 md:flex-none",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2 inline"})," Save Draft"]}),A&&o?e.jsxs(q,{onClick:P,className:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-500/20 flex-1 md:flex-none",disabled:j,children:[e.jsx(as,{className:"w-4 h-4 mr-2 inline"})," Publish Result"]}):e.jsx(q,{onClick:v,className:j?"bg-orange-500 hover:bg-orange-600 flex-1 md:flex-none":"bg-blue-600 hover:bg-blue-700 flex-1 md:flex-none",children:j?e.jsxs(e.Fragment,{children:[e.jsx(Cs,{className:"w-4 h-4 mr-2 inline"})," Request Unlock"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2 inline"})," Submit to Admin"]})})]})]}),e.jsx(O,{className:"overflow-hidden p-0 relative",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left whitespace-nowrap",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800 text-xs uppercase font-bold text-slate-500 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-3 w-48 sticky left-0 bg-slate-100 dark:bg-slate-800 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:"Student Name"}),x.map(g=>e.jsxs("th",{className:"p-3 text-center min-w-[100px]",children:[g.name.substring(0,15),e.jsxs("span",{className:"block text-[9px] opacity-60",children:["Max: ",g.maxMarks]})]},g.name)),e.jsx("th",{className:"p-3 w-24 text-center font-black",children:"Total"}),e.jsx("th",{className:"p-3 w-16 text-center",children:"Grade"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:N.map(g=>{const r=b[g.id];return r?e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-3 text-center font-mono text-slate-500",children:g.rollNo||"-"}),e.jsx("td",{className:"p-3 font-bold text-slate-700 dark:text-slate-200 sticky left-0 bg-white dark:bg-slate-900 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:g.name}),x.map(l=>e.jsx("td",{className:"p-2 text-center",children:e.jsx("input",{type:"text",className:`w-16 text-center p-2 rounded border outline-none font-bold transition-all focus:ring-2 focus:ring-blue-500 ${j?"bg-slate-100 text-slate-500 cursor-not-allowed":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700"}`,value:r.subjects[l.name]||"",onChange:n=>_(g.id,l.name,n.target.value),disabled:j,placeholder:"-",inputMode:"decimal"})},l.name)),e.jsx("td",{className:"p-3 text-center font-black text-blue-600 dark:text-blue-400",children:r.total}),e.jsx("td",{className:`p-3 text-center font-bold ${r.grade==="F"?"text-red-500":"text-green-600"}`,children:r.grade})]},g.id):null})})]})})})]})},Ps=({onPostNotice:d})=>{const[b,x]=t.useState(""),[j,m]=t.useState(""),[p,C]=t.useState(""),[v,N]=t.useState(!1),[h,k]=t.useState(!1);t.useEffect(()=>{if(v){const i=setTimeout(()=>N(!1),2e3);return()=>clearTimeout(i)}},[v]);const o=async()=>{if(!b||!j){alert("Please enter title and message");return}k(!0);const i=await d(b,j,p);k(!1),i&&(x(""),m(""),C(""),N(!0))};return e.jsx("div",{className:"max-w-md mx-auto animate-fade-in-up",children:e.jsxs(O,{className:"border-t-4 border-t-blue-500 relative overflow-hidden",children:[v&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(W,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:p?"Scheduled!":"Notice Posted!"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(ls,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Post Notice"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Inform students & parents"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Title"}),e.jsx(E,{placeholder:"e.g. Exam Schedule",value:b,onChange:i=>x(i.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Message"}),e.jsx("textarea",{className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-3 text-sm h-32 resize-none",placeholder:"Type here...",value:j,onChange:i=>m(i.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Schedule for Later (Optional)"}),e.jsx(E,{type:"datetime-local",value:p,onChange:i=>C(i.target.value)})]}),e.jsxs(q,{onClick:o,disabled:h,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4"}),h?"Posting...":p?"Schedule Post":"Post Notice"]})]})]})})},Ms=({subjects:d,onAddSubject:b,onDeleteSubject:x,canEdit:j})=>{const[m,p]=t.useState({name:"",max:"50",pass:"18"}),[C,v]=t.useState(!1),N=async()=>{if(!m.name)return;v(!0);const h=parseInt(m.max)||50,k=parseInt(m.pass)||18,o=await b(m.name,h,k);v(!1),o&&p({name:"",max:"50",pass:"18"})};return e.jsx("div",{className:"max-w-2xl mx-auto animate-fade-in-up",children:e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-2 rounded-lg text-purple-600 dark:text-purple-400",children:e.jsx(_e,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:"Manage Subjects"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Add or remove subjects for this class."})]})]}),e.jsxs("div",{className:"space-y-3 mb-8",children:[d.map((h,k)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-700 dark:text-slate-200",children:h.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Max: ",h.maxMarks," | Pass: ",h.passMarks]})]}),j&&e.jsx("button",{onClick:()=>x(k),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(qe,{className:"w-4 h-4"})})]},k)),d.length===0&&e.jsx("p",{className:"text-center text-slate-400 text-sm",children:"No subjects added."})]}),j?e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-900 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 uppercase",children:"Add New Subject"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx(E,{placeholder:"Subject Name (e.g. Maths)",value:m.name,onChange:h=>p({...m,name:h.target.value}),className:"flex-[2]"}),e.jsx("div",{className:"flex-1",children:e.jsx(E,{type:"number",placeholder:"Max",value:m.max,onChange:h=>p({...m,max:h.target.value})})}),e.jsx("div",{className:"flex-1",children:e.jsx(E,{type:"number",placeholder:"Pass",value:m.pass,onChange:h=>p({...m,pass:h.target.value})})})]}),e.jsx(q,{onClick:N,disabled:C,className:"w-full flex justify-center items-center gap-2",children:C?"Adding...":e.jsxs(e.Fragment,{children:[e.jsx(ws,{className:"w-4 h-4"})," Add Subject"]})})]}):e.jsx("div",{className:"text-center p-4 bg-yellow-50 text-yellow-700 text-sm rounded-lg border border-yellow-200",children:"Subject editing is disabled by Admin."})]})})},Rs=({students:d,classId:b})=>{const[x,j]=t.useState("DAILY"),[m,p]=t.useState(new Date().toISOString().split("T")[0]),[C,v]=t.useState("Term 1"),[N,h]=t.useState({}),[k,o]=t.useState(!1),[i,L]=t.useState(!1),[T,F]=t.useState(50);t.useEffect(()=>{R()},[x,m,C]);const R=async()=>{o(!0);const r={};x==="DAILY"?((await c.getAttendanceByDate(b,m)).forEach(n=>{r[n.studentId]=n.status}),d.forEach(n=>{r[n.id]||(r[n.id]="PRESENT")})):((await c.getAttendanceByTerm(b,C)).forEach(n=>{r[n.studentId]={present:n.presentDays,total:n.workingDays},n.workingDays&&F(n.workingDays)}),d.forEach(n=>{r[n.id]||(r[n.id]={present:0,total:T})})),h(r),o(!1)},A=r=>{h(l=>{const n=l[r],u=n==="PRESENT"?"ABSENT":n==="ABSENT"?"LATE":"PRESENT";return{...l,[r]:u}})},P=(r,l)=>{const n=parseInt(l)||0;h(u=>({...u,[r]:{present:n,total:T}}))},_=async()=>{L(!0);const r=d.map(n=>({studentId:n.id,classId:b,date:m,status:N[n.id],type:"DAILY"})),l=await c.markDailyAttendance(r);L(!1),l.success?alert("Daily Attendance Saved!"):alert("Failed to save.")},g=async()=>{L(!0);const r=d.map(n=>{var u;return{studentId:n.id,classId:b,term:C,workingDays:T,presentDays:((u=N[n.id])==null?void 0:u.present)||0,status:"PRESENT",type:"SUMMARY"}}),l=await c.saveSummaryAttendance(r);L(!1),l.success?alert("Term Attendance Saved!"):alert("Failed to save.")};return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 gap-4",children:[e.jsxs("div",{className:"flex items-center bg-slate-100 dark:bg-slate-900 p-1 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsxs("button",{onClick:()=>j("DAILY"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${x==="DAILY"?"bg-white dark:bg-slate-800 shadow text-blue-600 dark:text-blue-400":"text-slate-500"}`,children:[e.jsx(He,{className:"w-4 h-4"})," Daily Tracker"]}),e.jsxs("button",{onClick:()=>j("SUMMARY"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${x==="SUMMARY"?"bg-white dark:bg-slate-800 shadow text-purple-600 dark:text-purple-400":"text-slate-500"}`,children:[e.jsx(ys,{className:"w-4 h-4"})," Term Summary"]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[x==="DAILY"?e.jsx(E,{type:"date",value:m,onChange:r=>p(r.target.value),className:"font-bold text-sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{value:C,onChange:r=>v(r.target.value),className:"w-32 text-sm py-2",children:[e.jsx("option",{children:"Term 1"}),e.jsx("option",{children:"Term 2"}),e.jsx("option",{children:"Finals"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-900 px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase whitespace-nowrap",children:"Total Days:"}),e.jsx("input",{type:"number",className:"w-12 bg-transparent text-sm font-bold text-center outline-none",value:T,onChange:r=>F(parseInt(r.target.value)||0)})]})]}),e.jsx(q,{onClick:x==="DAILY"?_:g,disabled:i,className:"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/20",children:i?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"})," Save"]})})]})]}),e.jsx(O,{className:"p-0 overflow-hidden min-h-[400px]",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-4",children:"Student Name"}),e.jsx("th",{className:"p-4 text-center",children:"Status / Days Present"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:d.map(r=>{var l,n,u;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-4 text-center text-slate-500 font-mono",children:r.rollNo||"-"}),e.jsx("td",{className:"p-4 font-bold text-slate-700 dark:text-slate-200",children:r.name}),e.jsx("td",{className:"p-4 text-center",children:k?e.jsx("div",{className:"h-8 w-24 bg-slate-100 dark:bg-slate-800 rounded animate-pulse mx-auto"}):x==="DAILY"?e.jsxs("button",{onClick:()=>A(r.id),className:`w-32 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all ${N[r.id]==="PRESENT"?"bg-green-100 text-green-700 border border-green-200":N[r.id]==="ABSENT"?"bg-red-100 text-red-700 border border-red-200":"bg-yellow-100 text-yellow-700 border border-yellow-200"}`,children:[N[r.id]==="PRESENT"&&e.jsx(W,{className:"w-4 h-4"}),N[r.id]==="ABSENT"&&e.jsx(ns,{className:"w-4 h-4"}),N[r.id]==="LATE"&&e.jsx(Ye,{className:"w-4 h-4"}),N[r.id]||"PRESENT"]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"number",className:"w-16 p-2 text-center font-bold bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none",value:((l=N[r.id])==null?void 0:l.present)||0,onChange:M=>P(r.id,M.target.value)})}),e.jsxs("span",{className:"text-slate-400 text-xs",children:["/ ",T]}),e.jsxs("span",{className:`text-xs font-bold ml-2 ${((n=N[r.id])==null?void 0:n.present)/T<.75?"text-red-500":"text-green-500"}`,children:[T>0?Math.round(((u=N[r.id])==null?void 0:u.present)/T*100):0,"%"]})]})})]},r.id)})})]})})]})},Ds=({classId:d})=>{var r;const[b,x]=t.useState([]),[j,m]=t.useState([]),[p,C]=t.useState(null),[v,N]=t.useState(new Date().toISOString().split("T")[0]),[h,k]=t.useState({}),[o,i]=t.useState(!1),[L,T]=t.useState(!1);t.useEffect(()=>{F()},[d]);const F=async()=>{i(!0);const l=await c.getAssessmentPrograms("TEACHER",d);x(l);const n=await c.getStudentsByClass(d);m(n),l.length>0&&C(l[0].id),i(!1)};t.useEffect(()=>{p&&R()},[p,v]);const R=async()=>{if(!p)return;const l=await c.getAssessmentLogs(p,v),n={};l.forEach(u=>{n[u.studentId]=u.totalScore}),k(n)},A=(l,n)=>{k(u=>({...u,[l]:n}))},P=async()=>{if(!p)return;T(!0);const l=j.map(n=>{const u=h[n.id];return u===void 0?Promise.resolve():c.logAssessmentEntry({programId:p,studentId:n.id,date:v,data:{score:u}})});await Promise.all(l),T(!1),alert("Assessment Data Saved!")},_=()=>b.find(l=>l.id===p),g=(l,n,u=5)=>{const M=h[l]||0;return n==="STAR"?e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(B=>e.jsx(Ge,{className:`w-6 h-6 cursor-pointer transition-colors ${B<=M?"fill-yellow-400 text-yellow-400":"text-slate-300"}`,onClick:()=>A(l,B)},B))}):n==="EMOJI"?e.jsxs("div",{className:"flex gap-3",children:[e.jsx(bs,{className:`w-6 h-6 cursor-pointer ${M===3?"text-green-500 scale-125":"text-slate-300"}`,onClick:()=>A(l,3)}),e.jsx(gs,{className:`w-6 h-6 cursor-pointer ${M===2?"text-yellow-500 scale-125":"text-slate-300"}`,onClick:()=>A(l,2)}),e.jsx(vs,{className:`w-6 h-6 cursor-pointer ${M===1?"text-red-500 scale-125":"text-slate-300"}`,onClick:()=>A(l,1)})]}):n==="YESNO"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(l,10),className:`p-2 rounded ${M===10?"bg-green-500 text-white":"bg-slate-100 text-slate-400"}`,children:e.jsx(fs,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(l,0),className:`p-2 rounded ${M===0&&h[l]!==void 0?"bg-red-500 text-white":"bg-slate-100 text-slate-400"}`,children:e.jsx(js,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{type:"number",className:"w-16 text-center h-8",value:M,onChange:B=>A(l,parseInt(B.target.value)||0)}),e.jsxs("span",{className:"text-xs text-slate-400",children:["/ ",u]})]})};return o?e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Loading Assessments..."}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[e.jsx(Ye,{className:"w-5 h-5 text-purple-500"}),e.jsxs("select",{className:"bg-transparent font-bold text-slate-700 dark:text-white outline-none cursor-pointer",value:p||"",onChange:l=>C(l.target.value),children:[b.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id)),b.length===0&&e.jsx("option",{children:"No Active Programs"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-900 px-3 py-1.5 rounded-lg",children:[e.jsx(ze,{className:"w-4 h-4 text-slate-500"}),e.jsx("input",{type:"date",className:"bg-transparent text-xs font-bold outline-none dark:text-white",value:v,onChange:l=>N(l.target.value)})]}),e.jsx(q,{onClick:P,disabled:L,className:"bg-purple-600 hover:bg-purple-700 text-white shadow-lg shadow-purple-500/20",children:L?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4 mr-2"})," Save Data"]})})]})]}),p&&b.length>0?e.jsxs(O,{className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/10 p-3 text-center border-b border-purple-100 dark:border-purple-800",children:e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300 font-bold uppercase tracking-wider",children:["Evaluating: ",((r=_())==null?void 0:r.questions[0].text)||"General Performance"]})}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-4",children:"Student Name"}),e.jsx("th",{className:"p-4 text-center",children:"Performance"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:j.map(l=>{var n,u;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-4 text-center font-mono text-slate-500",children:l.rollNo||"-"}),e.jsx("td",{className:"p-4 font-bold text-slate-800 dark:text-white",children:l.name}),e.jsx("td",{className:"p-4 flex justify-center",children:g(l.id,((n=_())==null?void 0:n.type)||"STAR",(u=_())==null?void 0:u.questions[0].maxVal)})]},l.id)})})]})})]}):e.jsxs("div",{className:"text-center py-12 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-2xl bg-slate-50 dark:bg-slate-800/50",children:[e.jsx("p",{className:"text-slate-400",children:"No assessment programs available."}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Ask Admin to create programs in 'Academics > Assessments'."})]})]})},zs=({user:d})=>{const b=ds(),[x,j]=t.useState("attendance"),[m,p]=t.useState([]),[C,v]=t.useState([]),[N,h]=t.useState({}),[k,o]=t.useState(!1),[i,L]=t.useState(d.subjects),[T,F]=t.useState(d.submissionStatus==="SUBMITTED"),[R,A]=t.useState(!1),[P,_]=t.useState({name:d.teacherName||"",photo:d.teacherPhoto||""}),[g,r]=t.useState(!1),[l,n]=t.useState(null),[u,M]=t.useState(!1),[B,re]=t.useState(""),[Je,Ne]=t.useState([]),[Ze,we]=t.useState([]),[ve,ke]=t.useState(!1),[ne,ye]=t.useState({fees:!1,assessments:!1}),[Se,Ce]=t.useState({ai:5,results:1}),[Te,Ae]=t.useState(2),[de,oe]=t.useState([]),[Ee,U]=t.useState(!1),[K,V]=t.useState(0),[se,f]=t.useState(!1),[H,J]=t.useState([]);t.useEffect(()=>{z(),ae(),te()},[]);const te=async()=>{const a=await c.getNotifications(d.id,"TEACHER");oe(a),V(a.filter(w=>!w.isRead).length)},ce=async a=>{await c.markNotificationRead(a),oe(w=>w.map($=>$.id===a?{...$,isRead:!0}:$)),V(w=>Math.max(0,w-1))},ie=async()=>{const a=await c.getTeacherTransactionHistory(d.id);J(a),f(!0)},z=async()=>{o(!0);const[a,w]=await Promise.all([c.getSchoolConfig(),c.getGlobalSettings()]);if(n(a),A((a==null?void 0:a.allowTeacherSubjectEdit)??!1),ye({fees:w.MODULE_FEES!=="FALSE",assessments:w.MODULE_ASSESSMENTS!=="FALSE"}),w.FEATURE_COSTS)try{const Y=JSON.parse(w.FEATURE_COSTS);Ce(Y)}catch{}w.AI_TRIAL_LIMIT&&Ae(parseInt(w.AI_TRIAL_LIMIT)||2);const $=(a==null?void 0:a.feeManagerRole)||"ADMIN",X=(await c.getFeeStructures(d.id)).filter(Y=>Y.collectedBy==="TEACHER"||Y.collectedBy==="BOTH"||$==="TEACHER"||$==="HYBRID");we(X),ke(X.length>0);const Re=await c.getStudentsByClass(d.id);p(Re);const fe={};for(const Y of Re){const Le=await c.getMarks(Y.id,"Term 1");Le?fe[Y.id]=Le:fe[Y.id]={studentId:Y.id,subjects:i.reduce((Qe,Xe)=>({...Qe,[Xe.name]:0}),{}),total:0,grade:"F",term:"Term 1"}}h(fe);const De=await c.getPendingAdmissions(d.id);v(De),De.length>0&&((a==null?void 0:a.admissionApprover)==="TEACHER"||(a==null?void 0:a.admissionApprover)==="BOTH"||!(a!=null&&a.admissionApprover))&&j("students"),o(!1)},ae=async()=>{const a=await c.getAssessmentPrograms("TEACHER",d.id);Ne(a)},G=(a,w,$)=>{h(Q=>{const X={...Q[a]};return X.subjects={...X.subjects,[w]:$},{...Q,[a]:X}})},xe=async()=>{for(const a of Object.values(N))await c.saveMarks(a);alert("Saved!")},me=async()=>{(await c.toggleClassSubmission(d.id,!0)).success&&F(!0)},he=async(a,w)=>{w==="APPROVE"?await c.verifyStudent(a,d.teacherName):await c.rejectAdmission(a),z()},ue=async a=>{await c.deleteStudent(a),z()},pe=async()=>{await c.deleteUnverifiedStudents(d.id),z()},be=async(a,w,$)=>{const Q=[...i,{name:a,maxMarks:w,passMarks:$}];return await c.updateClassSubjects(d.id,Q),L(Q),!0},ge=async a=>{const w=[...i];w.splice(a,1),await c.updateClassSubjects(d.id,w),L(w)},le=async(a,w,$)=>(await c.createCampusPost(d.schoolId,d.teacherName||"Teacher",w,"TEACHER","NOTICE",a,$),!0),Pe=async()=>{await c.updateClassDetails(d.id,{teacherName:P.name}),r(!1)},Z=async a=>{},s={total:m.length,male:m.filter(a=>a.gender==="Male").length,female:m.filter(a=>a.gender==="Female").length},y=async()=>{if(!B||B.length<4)return alert("Password must be at least 4 characters.");o(!0);const a=await c.changeClassPassword(d.id,B);o(!1),a.success?(alert("Password updated successfully!"),M(!1),re("")):alert("Update Failed: "+a.message)},S=()=>x==="students"?e.jsxs("div",{className:"flex items-center gap-2 mt-2 sm:mt-0",children:[e.jsx("div",{className:"flex items-center gap-1 bg-blue-50 dark:bg-blue-900/40 px-2 py-1 rounded",children:e.jsxs("span",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:[s.male," B"]})}),e.jsx("div",{className:"flex items-center gap-1 bg-pink-50 dark:bg-pink-900/40 px-2 py-1 rounded",children:e.jsxs("span",{className:"text-xs font-bold text-pink-700 dark:text-pink-300",children:[s.female," G"]})})]}):null,I=()=>{const a=l==null?void 0:l.teacherQuota;return!a||a.frequency==="UNLIMITED"?null:e.jsxs("div",{className:"flex items-center gap-2 text-[10px] bg-purple-50 dark:bg-purple-900/20 text-purple-700 px-3 py-1 rounded border border-purple-100 dark:border-purple-800 cursor-pointer hover:bg-purple-100",onClick:ie,children:[e.jsx(xs,{className:"w-3 h-3 fill-current"}),e.jsxs("span",{children:["Limit: ",a.limit]})]})},D=[{id:"attendance",label:"Attendance",icon:He},{id:"students",label:"Students",icon:je},{id:"marks",label:"Marks",icon:is},{id:"exams",label:"Exams",icon:We},{id:"subjects",label:"Subjects",icon:_e},{id:"reports",label:"Reports",icon:ks}];return ne.assessments&&D.push({id:"assessments",label:"Skills",icon:Ge}),ne.fees&&ve&&D.push({id:"fees",label:"Fees",icon:ms}),e.jsxs("div",{className:"pb-20 relative animate-fade-in-up",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-4 mb-4 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative group shrink-0",children:[P.photo?e.jsx("img",{src:P.photo,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900 rounded-lg flex items-center justify-center text-blue-600 dark:text-blue-300",children:e.jsx(Ts,{className:"w-6 h-6"})}),g&&e.jsxs("label",{className:"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Z}),e.jsx(os,{className:"w-4 h-4 text-white"})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-black text-blue-600 dark:text-blue-400",children:d.name}),g?e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{className:"bg-slate-50 border rounded px-1 text-xs",value:P.name,onChange:a=>_({...P,name:a.target.value})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:Pe,className:"text-[10px] bg-green-100 text-green-700 px-2 rounded",children:"Save"}),e.jsx("button",{onClick:()=>M(!0),className:"text-[10px] bg-yellow-100 text-yellow-700 px-2 rounded",children:"Pass"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500",children:P.name||"Class Teacher"}),e.jsx("button",{onClick:()=>r(!0),className:"text-slate-400",children:e.jsx(Ss,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 justify-center sm:justify-end w-full sm:w-auto",children:[I(),e.jsxs("button",{onClick:()=>U(!0),className:"relative p-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-600 hover:bg-slate-200",children:[e.jsx($e,{className:"w-4 h-4"}),K>0&&e.jsx("span",{className:"absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white"})]}),e.jsx("button",{onClick:()=>b(`/school/${d.schoolId}`),className:"p-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-600",title:"Visit School Home",children:e.jsx(cs,{className:"w-4 h-4"})}),S()]})]}),e.jsx("div",{className:"flex justify-between items-center mb-6 overflow-x-auto pb-2 no-scrollbar",children:e.jsx("div",{className:"flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl max-w-full gap-1 border border-slate-200 dark:border-slate-700",children:D.map(a=>e.jsxs("button",{onClick:()=>j(a.id),className:`px-4 py-2 rounded-lg text-xs font-bold capitalize whitespace-nowrap flex items-center gap-2 transition-all ${x===a.id?"bg-white dark:bg-slate-700 text-blue-600 dark:text-blue-400 shadow-sm ring-1 ring-black/5":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:[e.jsx(a.icon,{className:"w-3 h-3"})," ",a.label]},a.id))})}),e.jsxs("div",{className:"mt-4 min-h-[50vh]",children:[x==="students"&&e.jsx(As,{user:d,students:m,pendingAdmissions:C,stats:s,sortingMethod:l==null?void 0:l.sortingMethod,onRefresh:z,onDeleteStudent:ue,onAdmissionAction:he,onCleanJunk:pe}),x==="subjects"&&e.jsx(Ms,{subjects:i,onAddSubject:be,onDeleteSubject:ge,canEdit:R}),x==="marks"&&e.jsx(Es,{students:m,marks:N,subjects:i,isSubmitted:T,loading:k,onMarkChange:G,onSaveAll:xe,onSubmitResults:me}),x==="attendance"&&e.jsx(Rs,{students:m,classId:d.id}),x==="exams"&&e.jsx(hs,{classId:d.id,featureCosts:Se,aiTrialLimit:Te}),x==="reports"&&e.jsx(Ps,{onPostNotice:le}),x==="assessments"&&e.jsx(Ds,{classId:d.id}),x==="fees"&&e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Fees Module coming soon."})]}),u&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(O,{className:"w-full max-w-sm bg-white dark:bg-slate-900 border-t-4 border-yellow-500",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-800 dark:text-white",children:"Change Access Password"}),e.jsx("p",{className:"text-xs text-slate-500 mb-4",children:"Set a new password for this class login."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-yellow-500 text-slate-900 dark:text-white",placeholder:"New Password",value:B,onChange:a=>re(a.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>M(!1),className:"flex-1 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl font-bold text-sm hover:bg-slate-200",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:k,className:"flex-1 py-3 bg-yellow-600 text-white rounded-xl font-bold text-sm hover:bg-yellow-700",children:k?"Saving...":"Update Password"})]})]})]})}),Ee&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in-up",onClick:()=>U(!1),children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-3xl p-6 shadow-2xl relative",onClick:a=>a.stopPropagation(),children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 dark:text-white flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-blue-500"})," Notifications"]}),e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto custom-scrollbar",children:de.length>0?de.map(a=>e.jsxs("div",{onClick:()=>!a.isRead&&ce(a.id),className:`p-3 rounded-xl border transition-all cursor-pointer ${a.isRead?"bg-slate-50 dark:bg-slate-800 border-slate-100 dark:border-slate-700":"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded ${a.type==="ALERT"?"bg-red-100 text-red-600":"bg-slate-200 text-slate-600"}`,children:a.type}),e.jsx("span",{className:"text-[10px] text-slate-400",children:new Date(a.createdAt).toLocaleDateString()})]}),e.jsx("h4",{className:"font-bold text-sm text-slate-800 dark:text-white",children:a.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-300 mt-1",children:a.message}),!a.isRead&&e.jsxs("div",{className:"mt-2 text-[10px] text-blue-500 font-bold flex items-center gap-1",children:[e.jsx(W,{className:"w-3 h-3"})," Mark Read"]})]},a.id)):e.jsx("p",{className:"text-center text-slate-400 text-sm py-8",children:"No notifications."})}),e.jsx("button",{onClick:()=>U(!1),className:"w-full mt-4 py-3 bg-slate-100 dark:bg-slate-800 rounded-xl font-bold text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-200",children:"Close"})]})})]})};export{zs as default};
