import{c as pe,r as l,j as e,G as O,U as fe,L as ve,C as K,a as je,b as M,d as V,e as Ce,f as Ne,X as we,g as ke,h as u,A as Te,R as Ae,M as Ee,S as Pe,B as Me,i as De,k as Re,l as Ue,u as Fe,m as Ie,H as Le,n as $e}from"./index-Cxmp2eWs.js";import Be from"./ExamsTab-CFQnVByr.js";import{H as Oe}from"./hard-drive-DAAT41Ye.js";import{P as Ye}from"./printer-C5SEO4qu.js";import{T as ye}from"./trash-2-BqpMS_RT.js";import{P as Ge}from"./pen-square-CSXHLjFG.js";import{A as He}from"./arrow-right-left-CdvaLylO.js";import{C as Ve,a as _e}from"./clipboard-check-B53NFhBN.js";import{S as Se}from"./save-Co4-mtpI.js";import{U as qe,a as ze}from"./user-cog-6a5F7Ytf.js";import{P as We}from"./plus-tnFknzSr.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=pe("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=pe("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=pe("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]),Ke=({user:r,students:N,pendingAdmissions:c,stats:g,sortingMethod:h,onRefresh:v,onDeleteStudent:E,onAdmissionAction:k,onCleanJunk:f})=>{const[b,P]=l.useState(!1),[n,x]=l.useState({regNo:"",rollNo:"",name:"",dob:"",gender:"",fatherName:"",motherName:"",photoUrl:""}),[F,C]=l.useState(!1),[I,U]=l.useState({name:!1,dob:!1,gender:!1}),[Y,D]=l.useState(""),[G,j]=l.useState(""),[a,m]=l.useState(!1),[d,T]=l.useState(!1),[R,Q]=l.useState(null),[z,ee]=l.useState(!1),[p,L]=l.useState({}),[_,se]=l.useState(""),[ne,H]=l.useState([]),[te,ae]=l.useState(!1),$=r.submissionStatus==="SUBMITTED"||r.submissionStatus==="APPROVED";l.useEffect(()=>{(async()=>{const w=await u.getClasses();H(w.filter(t=>t.id!==r.id))})()},[r.id]);const de=l.useMemo(()=>{const s=h||"BOYS_FIRST";if(s==="BOYS_FIRST"||s==="GIRLS_FIRST"){const w=N.filter(o=>o.gender==="Male").sort((o,i)=>(o.rollNo||9999)-(i.rollNo||9999)),t=N.filter(o=>o.gender!=="Male").sort((o,i)=>(o.rollNo||9999)-(i.rollNo||9999));return s==="BOYS_FIRST"?[...w,...t]:[...t,...w]}return[...N].sort((w,t)=>s==="ROLL_ONLY"?(w.rollNo||9999)-(t.rollNo||9999):s==="NAME_ONLY"?w.name.localeCompare(t.name):0)},[N,h]),oe=s=>{n[s]?U(w=>({...w,[s]:!1})):U(w=>({...w,[s]:!0}))},ce=async s=>{if(!s.target.files||s.target.files.length===0)return;if(!r.isPro){alert("Photo upload is an Elite/Pro feature.");return}T(!0);const w=s.target.files[0],t=await u.uploadImage(w,"students");T(!1),t.success&&t.publicUrl?(x(o=>({...o,photoUrl:t.publicUrl})),m(!1)):alert("Upload failed: "+t.message)},ie=async s=>{if(s.preventDefault(),$){alert("Class is locked/submitted. Ask admin to unlock before adding students.");return}j(""),D(""),U({name:!1,dob:!1,gender:!1});let w=!1;if(n.name||(U(i=>({...i,name:!0})),w=!0),n.dob||(U(i=>({...i,dob:!0})),w=!0),n.gender||(U(i=>({...i,gender:!0})),w=!0),w){j("âš ï¸ Please fill Name, DOB & Gender!");return}C(!0);const t={...n,fatherName:n.fatherName||"Not Entered",motherName:n.motherName||"Not Entered",addedBy:r.teacherName||"Class Teacher"};if(!t.photoUrl){const i=t.name||"Felix";t.photoUrl=`https://api.dicebear.com/7.x/avataaars/svg?seed=${i}&gender=${t.gender==="Female"?"female":"male"}`}const o=await u.createStudent(r.id,t);C(!1),o.success?(D(`âœ… ${n.name} Added!`),x({regNo:"",rollNo:"",name:"",dob:"",gender:"",fatherName:"",motherName:"",photoUrl:""}),v(),setTimeout(()=>D(""),2500)):alert("Failed: "+o.message)},xe=s=>{Q(s),L({...s}),ee(!1),se("")},me=async()=>{if($)return alert("Class is locked.");await u.updateStudentDetails(R.id,p),k(R.id,"APPROVE"),le(null)},he=async()=>{if(!_||!R)return;ae(!0);const s=await u.transferStudentAdmission(R.id,_);ae(!1),s.success?(alert("Student Transferred Successfully!"),Q(null),v()):alert("Transfer failed: "+s.message)},le=s=>{Q(s),ee(!1),L({})},W=`${window.location.origin}/#/register?schoolId=${r.schoolId}&classId=${r.id}`,ge=`Dear Parents,

Admission for *${r.name}* is now open.
Please register your child using the link below:

ðŸ”— ${W}

Thank you,
${r.teacherName||"Class Teacher"}`;return e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 animate-fade-in-up",children:[e.jsxs("div",{className:"md:col-span-1 space-y-6",children:[e.jsxs(O,{className:"bg-gradient-to-br from-indigo-600 to-purple-700 text-white border-none relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-20",children:e.jsx(fe,{className:"w-24 h-24"})}),e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Smart Invite"}),e.jsx("p",{className:"text-xs text-indigo-200 mb-4",children:"Share this link with parents for self-registration."}),e.jsx("div",{className:"bg-black/20 p-2 rounded-lg text-[10px] font-mono mb-4 break-all truncate border border-white/10",children:W}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>window.open(`https://wa.me/?text=${encodeURIComponent(ge)}`,"_blank"),className:"flex-1 bg-[#25D366] hover:bg-[#20bd5a] text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1 shadow-lg",children:"WhatsApp"}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(W),className:"flex-1 bg-white/10 hover:bg-white/20 text-white py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:"Copy Link"})]})]}),e.jsxs(O,{className:"bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800",children:[e.jsxs("h4",{className:"font-bold text-slate-700 dark:text-white flex items-center gap-2 text-sm mb-3",children:[e.jsx(Oe,{className:"w-4 h-4 text-orange-500"})," Class Health"]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2",children:[e.jsx("span",{className:"text-slate-500",children:"Verified Students"}),e.jsx("span",{className:"font-bold text-green-600",children:g.total})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs mb-3",children:[e.jsx("span",{className:"text-slate-500",children:"Pending/Ghost"}),e.jsx("span",{className:"font-bold text-red-500",children:c.length})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mb-3",children:e.jsx("div",{className:"bg-green-500 h-1.5 rounded-full",style:{width:`${g.total/(g.total+c.length||1)*100}%`}})}),e.jsxs("button",{onClick:f,disabled:c.length===0||$,className:"w-full text-xs flex items-center justify-center gap-1 bg-white dark:bg-slate-800 border border-red-200 dark:border-red-900/50 text-red-600 dark:text-red-400 py-2 rounded hover:bg-red-50 dark:hover:bg-red-900/20 disabled:opacity-50",children:[e.jsx(Ze,{className:"w-3 h-3"})," Delete All Unverified"]})]}),e.jsxs(O,{className:`border-t-4 ${$?"border-t-slate-400 opacity-80":"border-t-blue-500"} relative overflow-hidden`,children:[$&&e.jsxs("div",{className:"absolute inset-0 bg-white/60 dark:bg-slate-950/60 backdrop-blur-[1px] z-10 flex flex-col items-center justify-center text-center",children:[e.jsx(ve,{className:"w-8 h-8 text-slate-500 mb-2"}),e.jsx("p",{className:"text-sm font-bold text-slate-600 dark:text-slate-300",children:"Class Locked"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Results submitted. Cannot add students."})]}),Y&&e.jsxs("div",{className:"absolute inset-0 z-20 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(K,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:Y})]}),G&&e.jsx("div",{className:"mb-4 bg-red-50 text-red-600 p-2 rounded text-xs text-center border border-red-100",children:G}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(je,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Add Student"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Manual Entry"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"mb-4 flex gap-4 items-center bg-slate-50 dark:bg-slate-900 p-3 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"relative w-16 h-16 shrink-0 rounded-full overflow-hidden border-2 border-slate-200 shadow-sm",children:n.photoUrl?e.jsx("img",{src:n.photoUrl,className:"w-full h-full object-cover"}):e.jsx("img",{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${n.name||"Felix"}&gender=${n.gender==="Female"?"female":"male"}`,className:"w-full h-full opacity-80"})}),e.jsx("div",{className:"flex-1 space-y-2",children:a?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("label",{className:"cursor-pointer bg-slate-200 dark:bg-slate-700 px-3 py-1 rounded text-[10px] font-bold text-center block",children:[d?"Uploading...":"Choose File",e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:ce,disabled:d})]}),e.jsx("button",{type:"button",onClick:()=>m(!1),className:"text-[10px] text-red-500",children:"Cancel"})]}):e.jsxs("div",{children:[e.jsx(M,{className:"text-xs h-8",placeholder:"Paste Image URL...",value:n.photoUrl,onChange:s=>x({...n,photoUrl:s.target.value})}),r.isPro&&e.jsx("button",{type:"button",onClick:()=>m(!0),className:"text-[10px] text-blue-600 font-bold underline mt-1 block",children:"Or Upload File"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"FULL NAME *"}),e.jsx("input",{value:n.name,onChange:s=>x({...n,name:s.target.value.toUpperCase()}),onBlur:()=>oe("name"),className:`w-full bg-white dark:bg-slate-800 font-bold rounded-lg px-4 py-2.5 outline-none border-2 ${I.name?"border-red-500":"border-slate-300 dark:border-slate-600"}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"Gender *"}),e.jsxs("select",{className:"w-full bg-white dark:bg-slate-800 px-3 py-2.5 outline-none font-medium border-2 rounded-lg",value:n.gender,onChange:s=>x({...n,gender:s.target.value}),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"Male",children:"Boy"}),e.jsx("option",{value:"Female",children:"Girl"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 ml-1 font-bold uppercase",children:"DOB *"}),e.jsx("input",{type:"date",value:n.dob,onChange:s=>x({...n,dob:s.target.value}),className:`w-full bg-white dark:bg-slate-800 font-medium rounded-lg px-3 py-2 outline-none border-2 ${I.dob?"border-red-500":"border-slate-300 dark:border-slate-600"}`})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(M,{className:"text-sm font-mono",placeholder:"Reg No (Auto)",value:n.regNo,onChange:s=>x({...n,regNo:s.target.value})}),e.jsx(M,{type:"number",className:"text-sm font-mono",placeholder:"Roll No",value:n.rollNo,onChange:s=>x({...n,rollNo:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(M,{className:"text-sm",placeholder:"Father",value:n.fatherName,onChange:s=>x({...n,fatherName:s.target.value})}),e.jsx(M,{className:"text-sm",placeholder:"Mother",value:n.motherName,onChange:s=>x({...n,motherName:s.target.value})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(V,{onClick:ie,disabled:F,className:"w-full py-3 text-sm font-bold",children:F?"Saving...":"Save & Add Next"})})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[c.length>0&&e.jsxs(O,{className:"bg-orange-50 dark:bg-orange-900/10 border border-orange-200 dark:border-orange-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5"})," Pending Admissions (",c.length,")"]}),e.jsx("span",{className:"text-[10px] bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 px-2 py-1 rounded",children:"Action Required"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-3 max-h-64 overflow-y-auto pr-1 custom-scrollbar",children:c.map(s=>e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-xl shadow-sm border border-slate-100 dark:border-slate-800 flex items-center justify-between group hover:border-orange-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.photoUrl||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.name}`,className:"w-10 h-10 rounded-full object-cover bg-slate-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-sm text-slate-800 dark:text-white",children:s.name}),e.jsxs("p",{className:"text-[10px] text-slate-500",children:["Applied: ",new Date().toLocaleDateString()]})]})]}),e.jsx("button",{onClick:()=>xe(s),className:"bg-white dark:bg-slate-800 border border-blue-200 dark:border-blue-800 text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-blue-50 dark:hover:bg-blue-900/30 transition-colors",children:"Review"})]},s.id))})]}),e.jsxs(O,{className:"p-0 overflow-hidden min-h-[400px] relative",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800",children:[e.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-500"})," Class List (",N.length,")"]}),e.jsxs(V,{variant:"secondary",onClick:()=>P(!0),className:"text-xs flex items-center gap-1",disabled:$,children:[e.jsx(Ye,{className:"w-3 h-3"})," Register"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-10",children:"Roll"}),e.jsx("th",{className:"p-3",children:"Name"}),e.jsx("th",{className:"p-3 w-24",children:"Reg No"}),e.jsx("th",{className:"p-3 w-24",children:"DOB"}),e.jsx("th",{className:"p-3 w-20 text-center",children:"Action"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:de.map(s=>e.jsxs("tr",{className:"group hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-3 text-center text-slate-500",children:s.rollNo||"-"}),e.jsx("td",{className:"p-3 text-slate-800 dark:text-white",children:e.jsxs("div",{className:"flex items-center gap-2 font-bold",children:[s.photoUrl&&e.jsx("img",{src:s.photoUrl,className:"w-6 h-6 rounded-full object-cover"}),s.name,s.isPremium&&e.jsx(Ce,{className:"w-3 h-3 text-yellow-500"})]})}),e.jsx("td",{className:"p-3 font-mono text-slate-600 dark:text-slate-300",children:s.regNo}),e.jsx("td",{className:"p-3 text-slate-500 font-mono",children:Ne(s.dob)}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("button",{onClick:()=>E(s.id,s.name),disabled:$,className:"p-2 text-slate-400 hover:text-red-500 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(ye,{className:"w-4 h-4"})})})]},s.id))})]})})]})]}),R&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(O,{className:"w-full max-w-2xl bg-white dark:bg-slate-900 border-t-4 border-t-blue-600 max-h-[90vh] overflow-y-auto flex flex-col p-0",children:[e.jsxs("div",{className:"p-6 pb-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50 dark:bg-slate-950",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Review Application"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Verify details before approving."})]}),e.jsx("button",{onClick:()=>le(null),className:"p-2 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-full transition-colors",children:e.jsx(we,{className:"w-5 h-5 text-slate-500"})})]}),e.jsxs("div",{className:"p-6 grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("img",{src:R.photoUrl||`https://api.dicebear.com/7.x/avataaars/svg?seed=${R.name}`,className:"w-32 h-32 rounded-full object-cover mx-auto border-4 border-white dark:border-slate-800 shadow-lg bg-slate-100"}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-2",children:"Applicant Photo"})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-900/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-bold text-blue-800 dark:text-blue-300 text-sm",children:"Student Details"}),e.jsxs("button",{onClick:()=>ee(!z),className:"text-xs text-blue-600 underline flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"})," ",z?"Cancel Edit":"Edit"]})]}),e.jsx("div",{className:"space-y-2 text-sm",children:z?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-8 text-xs",value:p.name,onChange:s=>L({...p,name:s.target.value.toUpperCase()}),placeholder:"Name"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(M,{className:"h-8 text-xs",value:p.regNo,onChange:s=>L({...p,regNo:s.target.value}),placeholder:"Reg No"}),e.jsx("input",{type:"date",className:"h-8 text-xs bg-white dark:bg-slate-800 border rounded px-2 w-full",value:p.dob,onChange:s=>L({...p,dob:s.target.value})})]}),e.jsxs("select",{className:"h-8 text-xs bg-white dark:bg-slate-800 border rounded px-2 w-full",value:p.gender,onChange:s=>L({...p,gender:s.target.value}),children:[e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Name:"})," ",e.jsx("span",{className:"font-bold",children:p.name})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Reg No:"})," ",e.jsx("span",{className:"font-mono",children:p.regNo||"-"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"DOB:"})," ",e.jsx("span",{children:Ne(p.dob)})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-16 inline-block",children:"Gender:"})," ",e.jsx("span",{children:p.gender})]})]})})]})]}),e.jsxs("div",{className:"space-y-6 flex flex-col h-full",children:[e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700",children:[e.jsx("h4",{className:"font-bold text-slate-700 dark:text-slate-300 text-sm mb-3",children:"Parent Information"}),e.jsx("div",{className:"space-y-2 text-sm",children:z?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-8 text-xs",value:p.fatherName,onChange:s=>L({...p,fatherName:s.target.value}),placeholder:"Father's Name"}),e.jsx(M,{className:"h-8 text-xs",value:p.motherName,onChange:s=>L({...p,motherName:s.target.value}),placeholder:"Mother's Name"}),e.jsx(M,{className:"h-8 text-xs",value:p.phone,onChange:s=>L({...p,phone:s.target.value}),placeholder:"Phone"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Father:"})," ",e.jsx("span",{className:"font-bold",children:p.fatherName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Mother:"})," ",e.jsx("span",{children:p.motherName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Phone:"})," ",e.jsx("span",{children:p.phone})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-slate-500 w-20 inline-block",children:"Address:"})," ",e.jsx("span",{className:"text-xs",children:p.address||"-"})]})]})})]}),e.jsxs("div",{className:"mt-auto pt-6 border-t border-slate-100 dark:border-slate-800",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Wrong Class? Transfer Request"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ke,{className:"h-9 text-xs py-0",value:_,onChange:s=>se(s.target.value),children:[e.jsx("option",{value:"",children:"Select Target Class"}),ne.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("button",{onClick:he,disabled:!_||te,className:"bg-purple-100 text-purple-700 px-3 rounded-lg text-xs font-bold hover:bg-purple-200 transition-colors whitespace-nowrap",children:te?"Moving...":e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-3 h-3 inline mr-1"})," Move"]})})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>k(R.id,"REJECT"),className:"flex-1 py-3 border border-red-200 text-red-600 rounded-xl font-bold text-sm hover:bg-red-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"})," Reject"]}),e.jsxs("button",{onClick:me,disabled:$,className:"flex-[2] py-3 bg-green-600 text-white rounded-xl font-bold text-sm hover:bg-green-700 shadow-lg shadow-green-500/30 transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(K,{className:"w-4 h-4"})," Approve Admission"]})]})]})]})]})]})})]})},Qe=({students:r,marks:N,subjects:c,isSubmitted:g,loading:h,onMarkChange:v,onSaveAll:E,onSubmitResults:k})=>{const f=[...r].sort((j,a)=>(j.rollNo||9999)-(a.rollNo||9999)),[b,P]=l.useState("TERM"),[n,x]=l.useState(!1),[F,C]=l.useState(!1),[I,U]=l.useState(null);l.useEffect(()=>{(async()=>{const a=await u.getSchoolConfig();a!=null&&a.allowTeacherDirectPublish&&x(!0)})()},[]);const Y=["CLASS_TEST","REVISION"].includes(b),D=async()=>{if(Y&&n){if(!confirm(`Directly publish ${b} results? Parents will see this immediately.`))return;C(!0),k()}else k()},G=(j,a,m)=>{if(U(null),m===""||m.toUpperCase()==="AB"||m.toUpperCase()==="A"){v(j,a,m);return}const d=parseFloat(m);if(isNaN(d))return;const T=c.find(R=>R.name===a);if(T){if(d>T.maxMarks){U(`Cannot enter ${d} for ${a}. Max is ${T.maxMarks}.`);return}if(d<0)return}v(j,a,m)};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm relative",children:[I&&e.jsxs("div",{className:"absolute top-full left-0 right-0 bg-red-100 text-red-700 text-xs font-bold p-2 text-center border-b border-red-200 z-20 animate-fade-in-up",children:[e.jsx(Te,{className:"w-3 h-3 inline mr-1"})," ",I]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Assessment Type"}),e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>P("TERM"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${b==="TERM"?"bg-white dark:bg-slate-800 text-blue-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(Ve,{className:"w-4 h-4"})," Term Exam"]}),e.jsxs("button",{onClick:()=>P("CLASS_TEST"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${b==="CLASS_TEST"?"bg-white dark:bg-slate-800 text-purple-600 shadow-sm":"text-slate-500"}`,children:[e.jsx(_e,{className:"w-4 h-4"})," Class Test"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white hidden md:block",children:"Marks Entry"}),g&&e.jsxs("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded font-bold flex items-center gap-1",children:[e.jsx(ve,{className:"w-3 h-3"})," Locked"]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs(V,{onClick:E,variant:"secondary",disabled:h||g,className:"flex-1 md:flex-none",children:[e.jsx(Se,{className:"w-4 h-4 mr-2 inline"})," Save Draft"]}),Y&&n?e.jsxs(V,{onClick:D,className:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-500/20 flex-1 md:flex-none",disabled:g,children:[e.jsx(Ae,{className:"w-4 h-4 mr-2 inline"})," Publish Result"]}):e.jsx(V,{onClick:k,className:g?"bg-orange-500 hover:bg-orange-600 flex-1 md:flex-none":"bg-blue-600 hover:bg-blue-700 flex-1 md:flex-none",children:g?e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2 inline"})," Request Unlock"]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 inline"})," Submit to Admin"]})})]})]}),e.jsx(O,{className:"overflow-x-auto p-0",children:e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-slate-800 text-xs uppercase font-bold text-slate-500 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-3 w-48 sticky left-0 bg-slate-100 dark:bg-slate-800 z-10",children:"Student Name"}),c.map(j=>e.jsxs("th",{className:"p-3 text-center min-w-[80px]",children:[j.name.substring(0,10),e.jsxs("span",{className:"block text-[9px] opacity-60",children:["Max: ",j.maxMarks]})]},j.name)),e.jsx("th",{className:"p-3 w-24 text-center font-black",children:"Total"}),e.jsx("th",{className:"p-3 w-16 text-center",children:"Grade"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:f.map(j=>{const a=N[j.id];return a?e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-3 text-center font-mono text-slate-500",children:j.rollNo||"-"}),e.jsx("td",{className:"p-3 font-bold text-slate-700 dark:text-slate-200 sticky left-0 bg-white dark:bg-slate-900 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]",children:j.name}),c.map(m=>e.jsx("td",{className:"p-2 text-center",children:e.jsx("input",{type:"text",className:`w-12 text-center p-1.5 rounded border outline-none font-bold transition-all focus:ring-2 focus:ring-blue-500 ${g?"bg-slate-100 text-slate-500 cursor-not-allowed":"bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700"}`,value:a.subjects[m.name]||"",onChange:d=>G(j.id,m.name,d.target.value),disabled:g,placeholder:"-"})},m.name)),e.jsx("td",{className:"p-3 text-center font-black text-blue-600 dark:text-blue-400",children:a.total}),e.jsx("td",{className:`p-3 text-center font-bold ${a.grade==="F"?"text-red-500":"text-green-600"}`,children:a.grade})]},j.id):null})})]})})]})},es=({onPostNotice:r})=>{const[N,c]=l.useState(""),[g,h]=l.useState(""),[v,E]=l.useState(""),[k,f]=l.useState(!1),[b,P]=l.useState(!1);l.useEffect(()=>{if(k){const x=setTimeout(()=>f(!1),2e3);return()=>clearTimeout(x)}},[k]);const n=async()=>{if(!N||!g){alert("Please enter title and message");return}P(!0);const x=await r(N,g,v);P(!1),x&&(c(""),h(""),E(""),f(!0))};return e.jsx("div",{className:"max-w-md mx-auto animate-fade-in-up",children:e.jsxs(O,{className:"border-t-4 border-t-blue-500 relative overflow-hidden",children:[k&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-white/95 dark:bg-slate-900/95 flex flex-col items-center justify-center text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mb-4 animate-bounce",children:e.jsx(K,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 dark:text-white",children:v?"Scheduled!":"Notice Posted!"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center shrink-0",children:e.jsx(Ee,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-tight",children:"Post Notice"}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Inform students & parents"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Title"}),e.jsx(M,{placeholder:"e.g. Exam Schedule",value:N,onChange:x=>c(x.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Message"}),e.jsx("textarea",{className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-3 text-sm h-32 resize-none",placeholder:"Type here...",value:g,onChange:x=>h(x.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Schedule for Later (Optional)"}),e.jsx(M,{type:"datetime-local",value:v,onChange:x=>E(x.target.value)})]}),e.jsxs(V,{onClick:n,disabled:b,className:"w-full flex items-center justify-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),b?"Posting...":v?"Schedule Post":"Post Notice"]})]})]})})},ss=({subjects:r,onAddSubject:N,onDeleteSubject:c,canEdit:g})=>{const[h,v]=l.useState({name:"",max:"50",pass:"18"}),[E,k]=l.useState(!1),f=async()=>{if(!h.name)return;k(!0);const b=parseInt(h.max)||50,P=parseInt(h.pass)||18,n=await N(h.name,b,P);k(!1),n&&v({name:"",max:"50",pass:"18"})};return e.jsx("div",{className:"max-w-2xl mx-auto animate-fade-in-up",children:e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-slate-100 dark:border-slate-700",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-2 rounded-lg text-purple-600 dark:text-purple-400",children:e.jsx(Me,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:"Manage Subjects"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Add or remove subjects for this class."})]})]}),e.jsxs("div",{className:"space-y-3 mb-8",children:[r.map((b,P)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-700 dark:text-slate-200",children:b.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:["Max: ",b.maxMarks," | Pass: ",b.passMarks]})]}),g&&e.jsx("button",{onClick:()=>c(P),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(ye,{className:"w-4 h-4"})})]},P)),r.length===0&&e.jsx("p",{className:"text-center text-slate-400 text-sm",children:"No subjects added."})]}),g?e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-900 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-600 dark:text-slate-400 mb-3 uppercase",children:"Add New Subject"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx(M,{placeholder:"Subject Name (e.g. Maths)",value:h.name,onChange:b=>v({...h,name:b.target.value}),className:"flex-[2]"}),e.jsx("div",{className:"flex-1",children:e.jsx(M,{type:"number",placeholder:"Max",value:h.max,onChange:b=>v({...h,max:b.target.value})})}),e.jsx("div",{className:"flex-1",children:e.jsx(M,{type:"number",placeholder:"Pass",value:h.pass,onChange:b=>v({...h,pass:b.target.value})})})]}),e.jsx(V,{onClick:f,disabled:E,className:"w-full flex justify-center items-center gap-2",children:E?"Adding...":e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4"})," Add Subject"]})})]}):e.jsx("div",{className:"text-center p-4 bg-yellow-50 text-yellow-700 text-sm rounded-lg border border-yellow-200",children:"Subject editing is disabled by Admin."})]})})},ts=({students:r,classId:N})=>{const[c,g]=l.useState("DAILY"),[h,v]=l.useState(new Date().toISOString().split("T")[0]),[E,k]=l.useState("Term 1"),[f,b]=l.useState({}),[P,n]=l.useState(!1),[x,F]=l.useState(!1),[C,I]=l.useState(50);l.useEffect(()=>{U()},[c,h,E]);const U=async()=>{n(!0);const a={};c==="DAILY"?((await u.getAttendanceByDate(N,h)).forEach(d=>{a[d.studentId]=d.status}),r.forEach(d=>{a[d.id]||(a[d.id]="PRESENT")})):((await u.getAttendanceByTerm(N,E)).forEach(d=>{a[d.studentId]={present:d.presentDays,total:d.workingDays},d.workingDays&&I(d.workingDays)}),r.forEach(d=>{a[d.id]||(a[d.id]={present:0,total:C})})),b(a),n(!1)},Y=a=>{b(m=>{const d=m[a],T=d==="PRESENT"?"ABSENT":d==="ABSENT"?"LATE":"PRESENT";return{...m,[a]:T}})},D=(a,m)=>{const d=parseInt(m)||0;b(T=>({...T,[a]:{present:d,total:C}}))},G=async()=>{F(!0);const a=r.map(d=>({studentId:d.id,classId:N,date:h,status:f[d.id],type:"DAILY"})),m=await u.markDailyAttendance(a);F(!1),m.success?alert("Daily Attendance Saved!"):alert("Failed to save.")},j=async()=>{F(!0);const a=r.map(d=>{var T;return{studentId:d.id,classId:N,term:E,workingDays:C,presentDays:((T=f[d.id])==null?void 0:T.present)||0,status:"PRESENT",type:"SUMMARY"}}),m=await u.saveSummaryAttendance(a);F(!1),m.success?alert("Term Attendance Saved!"):alert("Failed to save.")};return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 gap-4",children:[e.jsxs("div",{className:"flex items-center bg-slate-100 dark:bg-slate-900 p-1 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsxs("button",{onClick:()=>g("DAILY"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${c==="DAILY"?"bg-white dark:bg-slate-800 shadow text-blue-600 dark:text-blue-400":"text-slate-500"}`,children:[e.jsx(De,{className:"w-4 h-4"})," Daily Tracker"]}),e.jsxs("button",{onClick:()=>g("SUMMARY"),className:`px-4 py-2 rounded-md text-xs font-bold flex items-center gap-2 transition-all ${c==="SUMMARY"?"bg-white dark:bg-slate-800 shadow text-purple-600 dark:text-purple-400":"text-slate-500"}`,children:[e.jsx(Je,{className:"w-4 h-4"})," Term Summary"]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto",children:[c==="DAILY"?e.jsx(M,{type:"date",value:h,onChange:a=>v(a.target.value),className:"font-bold text-sm"}):e.jsxs(e.Fragment,{children:[e.jsxs(ke,{value:E,onChange:a=>k(a.target.value),className:"w-32 text-sm py-2",children:[e.jsx("option",{children:"Term 1"}),e.jsx("option",{children:"Term 2"}),e.jsx("option",{children:"Finals"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-900 px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-800",children:[e.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase whitespace-nowrap",children:"Total Days:"}),e.jsx("input",{type:"number",className:"w-12 bg-transparent text-sm font-bold text-center outline-none",value:C,onChange:a=>I(parseInt(a.target.value)||0)})]})]}),e.jsx(V,{onClick:c==="DAILY"?G:j,disabled:x,className:"bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/20",children:x?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4 mr-2"})," Save"]})})]})]}),e.jsx(O,{className:"p-0 overflow-hidden min-h-[400px]",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50 text-slate-500 dark:text-slate-400 font-bold uppercase text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 w-16 text-center",children:"Roll"}),e.jsx("th",{className:"p-4",children:"Student Name"}),e.jsx("th",{className:"p-4 text-center",children:"Status / Days Present"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:r.map(a=>{var m,d,T;return e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors",children:[e.jsx("td",{className:"p-4 text-center text-slate-500 font-mono",children:a.rollNo||"-"}),e.jsx("td",{className:"p-4 font-bold text-slate-700 dark:text-slate-200",children:a.name}),e.jsx("td",{className:"p-4 text-center",children:P?e.jsx("div",{className:"h-8 w-24 bg-slate-100 dark:bg-slate-800 rounded animate-pulse mx-auto"}):c==="DAILY"?e.jsxs("button",{onClick:()=>Y(a.id),className:`w-32 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all ${f[a.id]==="PRESENT"?"bg-green-100 text-green-700 border border-green-200":f[a.id]==="ABSENT"?"bg-red-100 text-red-700 border border-red-200":"bg-yellow-100 text-yellow-700 border border-yellow-200"}`,children:[f[a.id]==="PRESENT"&&e.jsx(K,{className:"w-4 h-4"}),f[a.id]==="ABSENT"&&e.jsx(Re,{className:"w-4 h-4"}),f[a.id]==="LATE"&&e.jsx(Ue,{className:"w-4 h-4"}),f[a.id]||"PRESENT"]}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"relative",children:e.jsx("input",{type:"number",className:"w-16 p-2 text-center font-bold bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none",value:((m=f[a.id])==null?void 0:m.present)||0,onChange:R=>D(a.id,R.target.value)})}),e.jsxs("span",{className:"text-slate-400 text-xs",children:["/ ",C]}),e.jsxs("span",{className:`text-xs font-bold ml-2 ${((d=f[a.id])==null?void 0:d.present)/C<.75?"text-red-500":"text-green-500"}`,children:[C>0?Math.round(((T=f[a.id])==null?void 0:T.present)/C*100):0,"%"]})]})})]},a.id)})})]})})]})},bs=({user:r})=>{const N=Fe(),[c,g]=l.useState("students"),[h,v]=l.useState([]),[E,k]=l.useState([]),[f,b]=l.useState({}),[P,n]=l.useState(!1),[x,F]=l.useState(r.subjects),[C,I]=l.useState(r.submissionStatus==="SUBMITTED"),[U,Y]=l.useState(!1),[D,G]=l.useState({name:r.teacherName||"",photo:r.teacherPhoto||""}),[j,a]=l.useState(!1),[m,d]=l.useState(null),[T,R]=l.useState(!1),[Q,z]=l.useState(""),[ee,p]=l.useState([]),[L,_]=l.useState([]),[se,ne]=l.useState(!1);l.useEffect(()=>{H(),te()},[]);const H=async()=>{n(!0);const t=await u.getSchoolConfig();d(t),Y((t==null?void 0:t.allowTeacherSubjectEdit)??!1);const o=(t==null?void 0:t.feeManagerRole)||"ADMIN",A=(await u.getFeeStructures(r.id)).filter(B=>B.collectedBy==="TEACHER"||B.collectedBy==="BOTH"||o==="TEACHER"||o==="HYBRID");_(A),ne(A.length>0);const S=await u.getStudentsByClass(r.id);v(S);const y={};for(const B of S){const X=await u.getMarks(B.id,"Term 1");X?y[B.id]=X:y[B.id]={studentId:B.id,subjects:x.reduce((ue,be)=>({...ue,[be.name]:0}),{}),total:0,grade:"F",term:"Term 1"}}b(y);const J=await u.getPendingAdmissions(r.id);k(J),J.length>0&&((t==null?void 0:t.admissionApprover)==="TEACHER"||(t==null?void 0:t.admissionApprover)==="BOTH"||!(t!=null&&t.admissionApprover))&&g("students"),n(!1)},te=async()=>{const t=await u.getAssessmentPrograms("TEACHER",r.id);p(t)},ae=(t,o,i)=>{if(C)return;let A="";if(i!==""){const S=i.toUpperCase(),y=parseInt(i);if(isNaN(y)&&S!=="A"&&S!=="AB")return;S==="A"||S==="AB"?A=S:A=y}b(S=>{const y={...S[t]};y.subjects={...y.subjects,[o]:A};const J=Object.values(y.subjects).reduce((re,q)=>re+(typeof q=="number"?q:0),0);y.total=J;let B=0,X=!1;Object.keys(y.subjects).forEach(re=>{const q=x.find(Z=>Z.name===re);if(q){B+=q.maxMarks;const Z=y.subjects[re];(typeof Z=="number"?Z:0)<q.passMarks&&(X=!0)}});const{grade:ue,resultStatus:be}=$e(J,B,X);return y.grade=ue,y.resultStatus=be,{...S,[t]:y}})},$=async()=>{n(!0);for(const t of Object.values(f))await u.saveMarks(t);n(!1),alert("All marks saved successfully!")},de=async()=>{if(C){const o=prompt("Request Admin to unlock this class? (Optional: Enter reason)");o!==null&&((await u.createSystemFeedback(`Unlock Request for Class ${r.name}. Reason: ${o}`,"SUPPORT",r.teacherName||"Teacher")).success?alert("Unlock Request Sent to Admin!"):alert("Failed to send request."));return}if(!window.confirm("Verify & Submit to Admin?"))return;(await u.toggleClassSubmission(r.id,!0)).success&&(I(!0),alert("Submitted Successfully!"))},oe=async(t,o)=>{if(o==="APPROVE"){const i=await u.verifyStudent(t,r.teacherName||"Teacher");i.success?(H(),k(A=>A.filter(S=>S.id!==t))):alert(i.message)}else{if(!window.confirm("Reject this admission?"))return;(await u.rejectAdmission(t)).success&&k(A=>A.filter(S=>S.id!==t))}},ce=async(t,o)=>{if(!window.confirm(`Delete ${o}?`))return;const i=await u.deleteStudent(t);i.success?H():alert("Failed: "+i.message)},ie=async()=>{if(!window.confirm("Warning: This will delete all Unverified (Ghost) students in your class. Continue?"))return;(await u.deleteUnverifiedStudents(r.id)).success?(alert("Cleaned successfully!"),H()):alert("Failed to clean.")},xe=async(t,o,i)=>{const A=[...x,{name:t,maxMarks:o,passMarks:i}];return(await u.updateClassSubjects(r.id,A)).success?(F(A),H(),!0):(alert("Failed to add subject"),!1)},me=async t=>{if(!window.confirm("Delete this subject? Existing marks will be hidden."))return;const o=[...x];o.splice(t,1),(await u.updateClassSubjects(r.id,o)).success&&(F(o),H())},he=async(t,o,i)=>{const A=r.teacherName||r.name||"Teacher",S=i?new Date(i).toISOString():void 0,y=await u.createCampusPost(r.schoolId||"",A,o,"TEACHER","NOTICE",t,S);return y.success?!0:(alert("Failed: "+y.message),!1)},le=async()=>{(await u.updateClassDetails(r.id,{teacherName:D.name,teacherPhoto:D.photo})).success?a(!1):alert("Failed update")},W=async t=>{if(!t.target.files||t.target.files.length===0)return;if(!r.isPro){alert("Photo upload is an Elite/Pro feature.");return}const o=t.target.files[0],i=await u.uploadImage(o,"teachers");i.success&&i.publicUrl?G(A=>({...A,photo:i.publicUrl})):alert("Upload failed: "+i.message)},s={total:h.length,male:h.filter(t=>t.gender==="Male").length,female:h.filter(t=>t.gender==="Female").length},w=()=>{if(c==="students")return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-1 bg-blue-50 dark:bg-blue-900/40 px-2 py-1 rounded",children:e.jsxs("span",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:[s.male," B"]})}),e.jsx("div",{className:"flex items-center gap-1 bg-pink-50 dark:bg-pink-900/40 px-2 py-1 rounded",children:e.jsxs("span",{className:"text-xs font-bold text-pink-700 dark:text-pink-300",children:[s.female," G"]})})]});if(c==="marks"){const t=Object.values(f).filter(o=>o.total>0).length;return e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 dark:bg-slate-700 px-3 py-1 rounded text-xs",children:[e.jsx("span",{className:"text-slate-500 font-bold uppercase",children:"Progress:"}),e.jsxs("span",{className:`font-bold ${t===s.total?"text-green-600":"text-slate-800"}`,children:[t," / ",s.total]})]})}return null};return e.jsxs("div",{className:"pb-20 relative animate-fade-in-up",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-100 dark:border-slate-700 p-3 mb-4 flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsxs("div",{className:"relative group shrink-0",children:[D.photo?e.jsx("img",{src:D.photo,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900 rounded-lg flex items-center justify-center text-blue-600 dark:text-blue-300",children:e.jsx(ze,{className:"w-6 h-6"})}),j&&e.jsxs("label",{className:"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:W}),e.jsx(Ie,{className:"w-4 h-4 text-white"})]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-black text-blue-600 dark:text-blue-400",children:r.name}),j?e.jsxs("div",{className:"space-y-1",children:[e.jsx("input",{className:"bg-slate-50 border rounded px-1 text-xs",value:D.name,onChange:t=>G({...D,name:t.target.value})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:le,className:"text-[10px] bg-green-100 text-green-700 px-2 rounded",children:"Save"}),e.jsx("button",{onClick:()=>R(!0),className:"text-[10px] bg-yellow-100 text-yellow-700 px-2 rounded",children:"Pass"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500",children:D.name||"Class Teacher"}),e.jsx("button",{onClick:()=>a(!0),className:"text-slate-400",children:e.jsx(Xe,{className:"w-3 h-3"})})]})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(`/school/${r.schoolId}`),className:"p-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-600",title:"Visit School Home",children:e.jsx(Le,{className:"w-4 h-4"})}),w()]})]}),e.jsx("div",{className:"flex justify-between items-center mb-6 overflow-x-auto pb-2",children:e.jsx("div",{className:"flex bg-slate-200 dark:bg-slate-700 p-1 rounded-lg max-w-full",children:["students","subjects","marks","attendance","exams","assessments","reports","fees"].filter(t=>t!=="fees"||se).map(t=>e.jsx("button",{onClick:()=>g(t),className:`px-4 py-2 rounded-md text-sm font-bold capitalize whitespace-nowrap ${c===t?"bg-white dark:bg-slate-800 text-blue-600 dark:text-blue-400 shadow-sm":"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300"}`,children:t},t))})}),e.jsxs("div",{className:"mt-4",children:[c==="students"&&e.jsx(Ke,{user:r,students:h,pendingAdmissions:E,stats:s,sortingMethod:m==null?void 0:m.sortingMethod,onRefresh:H,onDeleteStudent:ce,onAdmissionAction:oe,onCleanJunk:ie}),c==="subjects"&&e.jsx(ss,{subjects:x,onAddSubject:xe,onDeleteSubject:me,canEdit:U}),c==="marks"&&e.jsx(Qe,{students:h,marks:f,subjects:x,isSubmitted:C,loading:P,onMarkChange:ae,onSaveAll:$,onSubmitResults:de}),c==="attendance"&&e.jsx(ts,{students:h,classId:r.id}),c==="exams"&&e.jsx(Be,{classId:r.id}),c==="reports"&&e.jsx(es,{onPostNotice:he}),c==="assessments"&&e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Assessments Module coming soon."}),c==="fees"&&e.jsx("div",{className:"text-center py-10 text-slate-400",children:"Fees Module coming soon."})]})]})};export{bs as default};
