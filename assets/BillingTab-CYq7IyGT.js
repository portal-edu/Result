import{c as V,r as l,i as x,j as e,G as w,Z as k,V as H,aa as W,n as q,C as Q,ak as A,a as Y}from"./index-OAThCskr.js";import{P as Z}from"./plus-fJcaQoMN.js";import{R as J}from"./settings-C0F8ytMl.js";import{Q as X}from"./qr-code-vrWCp9EK.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=V("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),de=({schoolConfig:m})=>{const[ee,E]=l.useState([]),[te,R]=l.useState(null),[U,y]=l.useState(m.walletBalance||0),[M,v]=l.useState(!1),[T,b]=l.useState(!1),[n,p]=l.useState(""),[u,d]=l.useState("INIT"),[F,i]=l.useState(""),[a,G]=l.useState(null),[h,L]=l.useState(null),[f,D]=l.useState(""),[C,I]=l.useState(!1),[c,_]=l.useState(1),[g,B]=l.useState(50);l.useEffect(()=>{j()},[]);const j=async()=>{v(!0);const[s,r,t]=await Promise.all([x.getWalletHistory(),x.getWalletAnalytics(),x.getGlobalSettings()]);if(E(s),R(r),t.GPAY_CONFIG)try{G(JSON.parse(t.GPAY_CONFIG))}catch{}t.CREDIT_BASE_PRICE&&_(parseFloat(t.CREDIT_BASE_PRICE)||1),t.MIN_RECHARGE_LIMIT&&B(parseInt(t.MIN_RECHARGE_LIMIT)||50);const o=await x.getSchoolConfig();o&&y(o.walletBalance||0),v(!1)},$=async()=>{if(!n)return;const s=parseInt(n);if(s<g){i(`Minimum purchase is ${g} Credits`);return}const r=s*c;d("PROCESSING"),i("");try{const t=await x.initializePayment(r,m.phone||"9999999999",m.schoolName,m.adminEmail);if(t.success){const o=await x.rechargeWallet(s,"Credit Pack Purchase",t.transactionId);o.success?(y(o.newBalance),d("SUCCESS"),j()):(i(o.message||"Payment Successful but Credit Update Failed."),d("FAILED"))}else t.gateway==="MANUAL"?(d("MANUAL_VIEW"),i("")):(i(t.message||"Transaction Failed"),d("FAILED"))}catch(t){i(t.message||"Unknown error"),d("FAILED")}},O=async()=>{if(!h||!f)return alert("Please select file and enter UTR.");I(!0);const r=parseInt(n)*c,t=await x.submitPaymentProof(r,f,h,"CREDIT_PURCHASE");I(!1),t.success?(alert("Proof Submitted! Credits will be added after verification."),b(!1)):alert("Upload Failed: "+t.message)},z=s=>{if(!(a!=null&&a.vpa))return"#";const t=(parseInt(s)||0)*c;return`upi://pay?pa=${a.vpa}&pn=${encodeURIComponent("ResultMate Services")}&am=${t}&tn=${encodeURIComponent("Ref: "+m.id.substring(0,6))}&cu=INR`},P=()=>{a!=null&&a.vpa&&(navigator.clipboard.writeText(a.vpa),alert("UPI ID Copied! Open your payment app and paste."))},N=({amount:s,bonus:r,popular:t})=>{const o=s*c;return e.jsxs("button",{onClick:()=>p(s.toString()),className:`relative flex flex-col items-center justify-center p-4 rounded-xl border-2 transition-all ${n===s.toString()?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 hover:border-blue-300"}`,children:[t&&e.jsx("div",{className:"absolute -top-3 bg-blue-600 text-white text-[9px] font-bold px-2 py-0.5 rounded-full uppercase",children:"Most Popular"}),e.jsx("div",{className:`p-2 rounded-full mb-2 ${n===s.toString()?"bg-blue-100 text-blue-600":"bg-slate-100 dark:bg-slate-700 text-slate-400"}`,children:e.jsx(k,{className:"w-5 h-5 fill-current"})}),e.jsx("div",{className:"text-lg font-black text-slate-800 dark:text-white",children:s}),e.jsx("div",{className:"text-[10px] text-slate-500 font-bold uppercase mb-1",children:"Credits"}),e.jsxs("div",{className:"text-xs font-bold text-slate-600 dark:text-slate-400",children:["₹",o]}),r&&e.jsxs("div",{className:"text-[9px] text-green-600 font-bold mt-1",children:["+",r," Free"]})]})},S=()=>{const s=parseInt(n)*c;return e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl text-left border border-slate-200 dark:border-slate-700 animate-fade-in-up",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-blue-600 mb-2 flex items-center justify-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"})," Google Pay / UPI"]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 bg-white dark:bg-slate-900 p-2 rounded-lg border border-slate-200 dark:border-slate-700 w-fit mx-auto",children:[e.jsx("p",{className:"text-xs text-slate-700 dark:text-slate-300 font-mono",children:(a==null?void 0:a.vpa)||"Not Configured"}),e.jsx("button",{onClick:P,className:"text-blue-600 hover:text-blue-700",title:"Copy UPI ID",children:e.jsx(A,{className:"w-4 h-4"})})]}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Payable Amount: ",e.jsxs("b",{children:["₹",s]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-lg border border-slate-200 dark:border-slate-700 mb-4",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-2",children:"Step 1: Pay using App"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("a",{href:z(n),className:"bg-blue-600 text-white text-center py-2 rounded text-xs font-bold hover:bg-blue-700 transition-colors flex items-center justify-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"})," Click to Open App"]}),e.jsxs("button",{onClick:P,className:"bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 border border-slate-300 dark:border-slate-700 text-center py-2 rounded text-xs font-bold hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors flex items-center justify-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"})," Copy UPI ID"]})]}),e.jsx("p",{className:"text-[10px] text-center mt-2 text-slate-400",children:"If app doesn't open, copy UPI ID and pay manually."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900 p-3 rounded-lg border border-slate-200 dark:border-slate-700",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase block mb-2",children:"Step 2: Upload Proof"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"w-full bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded p-2 text-xs",placeholder:"Enter UPI Ref No / UTR",value:f,onChange:r=>D(r.target.value)}),e.jsxs("label",{className:"block w-full border-2 border-dashed border-slate-300 dark:border-slate-600 rounded p-2 text-center text-xs text-slate-500 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[h?h.name:e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mx-auto mb-1"})," Upload Screenshot"]}),e.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:r=>{var t;return L(((t=r.target.files)==null?void 0:t[0])||null)}})]}),e.jsx("button",{onClick:O,disabled:C,className:"w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded text-xs font-bold",children:C?"Uploading...":"Submit Proof"})]})]})]})};return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(w,{className:"bg-gradient-to-br from-slate-900 to-indigo-900 text-white relative overflow-hidden flex flex-col justify-between min-h-[220px]",children:[e.jsx("div",{className:"absolute top-0 right-0 p-6 opacity-10",children:e.jsx(k,{className:"w-40 h-40 fill-white"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-300 uppercase tracking-wider mb-1",children:"Feature Credits"}),e.jsxs("h2",{className:"text-5xl font-black tracking-tight flex items-baseline gap-1",children:[U," ",e.jsx("span",{className:"text-lg font-bold text-slate-400",children:"CR"})]})]}),e.jsx("div",{className:"bg-white/10 p-2 rounded-lg backdrop-blur-md border border-white/10",children:e.jsx(k,{className:"w-6 h-6 text-yellow-400 fill-yellow-400"})})]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Use these credits for Result Publishing, AI & SMS."})]}),e.jsxs("div",{className:"relative z-10 mt-6 pt-6 border-t border-white/10 flex gap-3",children:[e.jsxs("button",{onClick:()=>{b(!0),d("INIT"),p(""),i("")},className:"flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white py-3 rounded-xl font-bold text-sm shadow-lg shadow-blue-900/30 flex items-center justify-center gap-2 transition-all",children:[e.jsx(Z,{className:"w-4 h-4"})," Buy Credits"]}),e.jsx("button",{onClick:j,className:"bg-white/10 hover:bg-white/20 text-white p-3 rounded-xl transition-all",children:e.jsx(J,{className:`w-5 h-5 ${M?"animate-spin":""}`})})]})]}),e.jsxs(w,{className:"bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-lg text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"})," Current Plan"]}),e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-[10px] font-bold uppercase",children:"Pay As You Go"})]}),e.jsxs("div",{className:"space-y-3 relative z-10 text-sm flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 rounded bg-green-50 dark:bg-green-900/10 border border-green-100 dark:border-green-800/30",children:[e.jsxs("span",{className:"text-slate-700 dark:text-slate-200 font-bold flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-green-600"})," Rate: ₹",c,"/Credit"]}),e.jsx("span",{className:"font-bold text-green-600 text-xs",children:"ACTIVE"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"Result Publishing"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-xs",children:"1 Credit / student"})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 rounded hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-300",children:"AI Question Gen"}),e.jsx("span",{className:"font-bold text-slate-800 dark:text-white bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-xs",children:"5 Credits / request"})]})]})]})]}),T&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(w,{className:"w-full max-w-md relative overflow-hidden bg-white dark:bg-slate-900 max-h-[90vh] overflow-y-auto",children:[e.jsx("button",{onClick:()=>b(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-slate-600 font-bold",children:"✕"}),u==="INIT"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Credit Store"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Choose a pack to top up."})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(N,{amount:100}),e.jsx(N,{amount:500,popular:!0}),e.jsx(N,{amount:1e3,bonus:100})]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 mb-6",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-2",children:"Or Enter Custom Amount"}),e.jsx("input",{type:"number",className:"w-full pl-4 py-2 bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg font-bold text-slate-800 dark:text-white",placeholder:`${g}+`,value:n,onChange:s=>p(s.target.value)}),n&&e.jsxs("p",{className:"text-right text-xs text-blue-600 font-bold mt-2",children:["Payable: ₹",(parseInt(n)||0)*c]})]}),e.jsx("button",{onClick:$,className:"w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-xl rounded-xl font-bold",children:"Buy Credits"})]}),u==="MANUAL_VIEW"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Payment Options"})}),a&&a.vpa?e.jsx(S,{}):e.jsx("div",{className:"text-center p-4 text-slate-500",children:"Admin hasn't configured manual payments. Contact support."}),e.jsx("button",{onClick:()=>d("INIT"),className:"w-full mt-4 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl font-bold text-sm",children:"Back"})]}),u==="FAILED"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(q,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"font-bold text-xl text-slate-800 dark:text-white",children:"Gateway Error"}),e.jsx("p",{className:"text-sm text-red-500 mt-2 font-bold mb-6",children:F}),a&&a.vpa&&e.jsxs("div",{className:"mt-4 border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("p",{className:"text-xs text-slate-500 mb-2",children:"Try Manual Payment instead:"}),e.jsx(S,{})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 py-3 text-slate-500 font-bold text-sm bg-slate-100 dark:bg-slate-800 rounded-xl",children:"Close"}),e.jsx("button",{onClick:()=>d("INIT"),className:"flex-1 py-3 bg-slate-900 text-white rounded-xl font-bold text-sm",children:"Retry"})]})]}),u==="SUCCESS"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"font-bold text-2xl text-slate-900 dark:text-white",children:"Success!"}),e.jsx("p",{className:"text-slate-500 mt-2 mb-6",children:"Credits added to wallet."}),e.jsx("button",{onClick:()=>b(!1),className:"bg-green-600 text-white px-6 py-2 rounded-full font-bold",children:"Done"})]})]})})]})};export{de as default};
