import{c as ne,r as n,h as E,j as e,d as A,G as z,b as C,v as pe,N as ae,Z as fe,m as be,F as we,at as Ne,au as T,a3 as je,l as ye}from"./index-Cxmp2eWs.js";import{T as ve}from"./trash-2-BqpMS_RT.js";import{P as Se}from"./plus-tnFknzSr.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=ne("Crop",[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ne("ScanSearch",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"m16 16-1.9-1.9",key:"1dq9hf"}]]),ke=({targetDate:p})=>{const[j,y]=n.useState("");return n.useEffect(()=>{const i=setInterval(()=>{const r=new Date().getTime(),x=new Date(p).getTime()-r;if(x<0){y("LIVE NOW"),clearInterval(i);return}const a=Math.floor(x/(1e3*60*60*24)),w=Math.floor(x%(1e3*60*60*24)/(1e3*60*60)),v=Math.floor(x%(1e3*60*60)/(1e3*60)),G=Math.floor(x%(1e3*60)/1e3);a>0?y(`${a}d ${w}h left`):y(`${w}h ${v}m ${G}s`)},1e3);return()=>clearInterval(i)},[p]),e.jsxs("span",{className:`text-[10px] font-bold px-2 py-1 rounded flex items-center gap-1 ${j==="LIVE NOW"?"bg-green-100 text-green-700 animate-pulse":"bg-blue-50 text-blue-600 border border-blue-100"}`,children:[e.jsx(ye,{className:"w-3 h-3"})," ",j||"Calculating..."]})},Ie=({imageSrc:p,onCrop:j,onCancel:y})=>{const i=n.useRef(null),r=n.useRef(null),[R,x]=n.useState(!1),[a,w]=n.useState(null),[v,G]=n.useState({x:0,y:0}),[P,B]=n.useState(!0),$=t=>{var h;const l=(h=r.current)==null?void 0:h.getBoundingClientRect();if(!l)return{x:0,y:0};const m=t.touches?t.touches[0].clientX:t.clientX,g=t.touches?t.touches[0].clientY:t.clientY;return{x:m-l.left,y:g-l.top}},f=t=>{const l=$(t);G(l),w({x:l.x,y:l.y,w:0,h:0}),x(!0)},Y=t=>{if(!R)return;const l=$(t);w({x:Math.min(v.x,l.x),y:Math.min(v.y,l.y),w:Math.abs(l.x-v.x),h:Math.abs(l.y-v.y)})},H=()=>x(!1);n.useEffect(()=>{p&&B(!0)},[p]);const b=()=>{if(r.current&&i.current){const t=i.current.naturalWidth/i.current.naturalHeight;let l=Math.min(window.innerWidth*.9,600),m=l/t;r.current.width=l,r.current.height=m,w(null);const g=r.current.getContext("2d");g&&(g.drawImage(i.current,0,0,l,m),g.fillStyle="rgba(0, 0, 0, 0.3)",g.fillRect(0,0,l,m)),setTimeout(()=>B(!1),600)}};n.useEffect(()=>{if(!r.current||!i.current||P)return;const t=r.current.getContext("2d");t&&(t.clearRect(0,0,r.current.width,r.current.height),t.drawImage(i.current,0,0,r.current.width,r.current.height),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,r.current.width,r.current.height),a&&a.w>0?(t.clearRect(a.x,a.y,a.w,a.h),t.drawImage(i.current,0,0,i.current.width,i.current.height,0,0,r.current.width,r.current.height),t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,r.current.width,a.y),t.fillRect(0,a.y+a.h,r.current.width,r.current.height-(a.y+a.h)),t.fillRect(0,a.y,a.x,a.h),t.fillRect(a.x+a.w,a.y,r.current.width-(a.x+a.w),a.h),t.strokeStyle="#00ff00",t.lineWidth=2,t.setLineDash([6]),t.strokeRect(a.x,a.y,a.w,a.h)):(t.font="bold 14px sans-serif",t.fillStyle="white",t.textAlign="center",t.fillText("Drag to select text",r.current.width/2,r.current.height/2)))},[a,P]);const M=()=>{if(!a||!i.current||a.w<10){if(i.current&&r.current){i.current.naturalWidth/r.current.width,i.current.naturalHeight/r.current.height,w({x:0,y:0,w:r.current.width,h:r.current.height}),setTimeout(()=>M(),100);return}return}const t=r.current,l=i.current;if(!t)return;const m=l.naturalWidth/t.width,g=l.naturalHeight/t.height,h=document.createElement("canvas");h.width=a.w*m,h.height=a.h*g;const F=h.getContext("2d");F==null||F.drawImage(l,a.x*m,a.y*g,a.w*m,a.h*g,0,0,h.width,h.height),h.toBlob(Q=>{Q&&j(Q)},"image/jpeg")};return e.jsxs("div",{className:"fixed inset-0 z-[70] bg-black/95 flex flex-col items-center justify-center p-4 backdrop-blur-sm",children:[P?e.jsxs("div",{className:"flex flex-col items-center animate-fade-in-up",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx(Te,{className:"w-16 h-16 text-green-500 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 bg-green-500/20 blur-xl rounded-full animate-ping"})]}),e.jsx("h3",{className:"text-white font-bold text-lg tracking-widest",children:"SCANNING PAGE..."}),e.jsx("p",{className:"text-slate-400 text-xs",children:"Analyzing text structure"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-800 px-6 py-2 rounded-full mb-4 flex items-center gap-2 shadow-lg border border-slate-700 animate-fade-in-up",children:[e.jsx(Ce,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-white text-sm font-bold",children:"Select the area to read"})]}),e.jsx("div",{className:"relative max-h-[70vh] overflow-hidden border-2 border-slate-700 rounded-lg bg-black shadow-2xl",children:e.jsx("canvas",{ref:r,onMouseDown:f,onMouseMove:Y,onMouseUp:H,onTouchStart:f,onTouchMove:Y,onTouchEnd:H,className:"cursor-crosshair block touch-none"})}),e.jsxs("div",{className:"flex gap-4 mt-6 w-full max-w-sm",children:[e.jsx(A,{variant:"secondary",onClick:y,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-800",children:"Discard"}),e.jsxs(A,{onClick:M,className:"flex-1 bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-900/20",children:[e.jsx(je,{className:"w-4 h-4 mr-2"})," ",a&&a.w>10?"Crop Selection":"Use Full Page"]})]})]}),e.jsx("img",{ref:i,src:p,className:"hidden",onLoad:b})]})},$e=({classId:p})=>{const[j,y]=n.useState([]),[i,r]=n.useState(!1),[R,x]=n.useState(!1),[a,w]=n.useState(null),[v,G]=n.useState([]),[P,B]=n.useState(!1),[$,f]=n.useState(!1),[Y,H]=n.useState(!1),[b,M]=n.useState("SCAN"),[t,l]=n.useState(""),[m,g]=n.useState(5),[h,F]=n.useState("From Book Only"),[Q,Ee]=n.useState("Malayalam"),[U,K]=n.useState([]),[q,V]=n.useState(!1),[ee,X]=n.useState(null),[Ae,Re]=n.useState([]),[D,te]=n.useState(""),[re,Me]=n.useState("CLASS_TEST"),[le,De]=n.useState(""),[O,oe]=n.useState(""),[J,ie]=n.useState(""),[Z,ce]=n.useState(30),[de,Oe]=n.useState({shuffleQuestions:!1,showResultImmediately:!0}),[N,S]=n.useState([{id:"1",text:"",options:["","","",""],correctOptionIndex:0,marks:1}]);n.useEffect(()=>{se()},[]);const ue=s=>{if(s.target.files&&s.target.files.length>0){const o=new FileReader;o.onload=c=>{var d;(d=c.target)!=null&&d.result&&(X(c.target.result),f(!1))},o.readAsDataURL(s.target.files[0])}},he=async()=>{if(b==="TOPIC"&&!t)return alert("Please enter a topic.");if(b==="SCAN"&&U.length===0)return alert("Please upload at least one page.");V(!0);const s=await E.useFeatureWithTrial("ai_gen",5,2,"AI Question Generation",void 0,"TEACHER");if(!s.success){V(!1),alert("Request Denied: "+s.message);return}const o=s.transactionId;try{const c=new Ne({apiKey:void 0}),d="gemini-2.5-flash",u=m+3,k=[];let L=`Generate ${u} multiple choice questions. Language: ${Q}. Provide JSON output with 'text', 'options' (array of 4 strings), 'correctOptionIndex' (0-3 number), and 'marks' (default 1).`;h==="From Book Only"?L+=" STRICT INSTRUCTION: Generate questions ONLY using the text content found in the provided images.":L+=` The questions should be appropriate for ${h} level students.`,b==="SCAN"?(U.forEach(W=>{k.push({inlineData:{mimeType:"image/jpeg",data:W.split(",")[1]}})}),L+=" Analyze the images thoroughly. Focus on key facts."):L+=` The topic is: "${t}".`,k.push({text:L});const me=await c.models.generateContent({model:d,contents:{parts:k},config:{responseMimeType:"application/json",responseSchema:{type:T.ARRAY,items:{type:T.OBJECT,properties:{text:{type:T.STRING},options:{type:T.ARRAY,items:{type:T.STRING}},correctOptionIndex:{type:T.INTEGER},marks:{type:T.INTEGER}}}}}}),_=JSON.parse(me.text||"[]");if(Array.isArray(_)&&_.length>0){const W=_.map(I=>({id:Math.random().toString(36).substr(2,9),text:I.text,options:I.options,correctOptionIndex:I.correctOptionIndex,marks:I.marks||1}));S(I=>[...I,...W]),f(!1),K([]),l("");const ge=s.isTrial?` (Free Trial Used - ${s.remaining} left)`:" (5 Credits Deducted)";alert(`${W.length} AI Questions Added!${ge}`)}else throw new Error("Invalid AI Response (Empty)")}catch{o?(await E.refundCredits(o,"AI Generation Failed"),alert("AI Generation failed. Credits have been refunded.")):alert("AI Failed. No credits deducted (Trial mode).")}finally{V(!1)}},se=async()=>{const s=await E.getExamsForClass(p);y(s)},xe=async()=>{if(!D||!O||!J)return alert("Please fill all details");x(!0);const s=await E.createExam({classId:p,title:D,examType:re,description:le,startTime:new Date(O).toISOString(),endTime:new Date(J).toISOString(),durationMinutes:Z,questions:N,settings:de});if(x(!1),s.success){try{const o=new Date(O).toLocaleDateString(),c=new Date(O).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d=`New Exam Scheduled: ${D} on ${o} at ${c}. Duration: ${Z} mins.`,u=await E.getSchoolConfig();u&&u.id&&await E.createCampusPost(u.id,"Exam Controller",d,"TEACHER","NOTICE",`Exam Alert: ${D}`)}catch(o){console.error("Failed to send auto-notification",o)}r(!1),se(),te(""),S([{id:"1",text:"",options:["","","",""],correctOptionIndex:0,marks:1}]),alert("Exam Scheduled & Students Notified!")}else alert(s.message)};return i?e.jsxs("div",{className:"max-w-3xl mx-auto animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Create Exam"}),e.jsx(A,{variant:"secondary",onClick:()=>r(!1),children:"Cancel"})]}),e.jsxs(z,{className:"mb-6 border-t-4 border-t-blue-600",children:[e.jsx(C,{placeholder:"Exam Title",value:D,onChange:s=>te(s.target.value)}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Start Time"}),e.jsx(C,{type:"datetime-local",value:O,onChange:s=>oe(s.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"End Time"}),e.jsx(C,{type:"datetime-local",value:J,onChange:s=>ie(s.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 mb-1 block",children:"Duration (Mins)"}),e.jsx(C,{type:"number",value:Z,onChange:s=>ce(parseInt(s.target.value))})]})]}),e.jsxs("p",{className:"text-[10px] text-orange-500 mt-2 flex items-center gap-1 font-bold",children:[e.jsx(pe,{className:"w-3 h-3"})," Warning: V9 System prevents scheduling two exams at the same time."]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-slate-700 dark:text-slate-300",children:["Questions (",N.length,")"]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>f(!0),className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg flex items-center gap-2 hover:scale-105 transition-transform",children:[e.jsx(ae,{className:"w-4 h-4 text-yellow-300"})," AI Generator ",e.jsx("span",{className:"bg-white/20 px-1 rounded text-[9px]",children:"Try Free"})]})})]}),e.jsx("div",{className:"space-y-4 mb-6",children:N.map((s,o)=>e.jsxs(z,{className:"relative",children:[e.jsx("button",{onClick:()=>{const c=[...N];c.splice(o,1),S(c)},className:"absolute top-2 right-2 text-slate-300 hover:text-red-500",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsxs("label",{className:"text-xs font-bold text-slate-400 mb-1 block",children:["Question ",o+1]}),e.jsx(C,{className:"mb-3 font-bold",value:s.text,onChange:c=>{const d=[...N];d[o].text=c.target.value,S(d)},placeholder:"Question Text"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:s.options.map((c,d)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("input",{type:"radio",name:`q-${s.id}`,checked:s.correctOptionIndex===d,onChange:()=>{const u=[...N];u[o].correctOptionIndex=d,S(u)},className:"w-4 h-4 accent-green-600 cursor-pointer"}),e.jsx(C,{className:"text-sm h-9",value:c,onChange:u=>{const k=[...N];k[o].options[d]=u.target.value,S(k)},placeholder:`Option ${d+1}`})]},d))})]},s.id))}),e.jsxs("div",{className:"flex gap-4 sticky bottom-4 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur p-2 rounded-2xl border shadow-xl",children:[e.jsx("button",{onClick:()=>S([...N,{id:Date.now().toString(),text:"",options:["","","",""],correctOptionIndex:0,marks:1}]),className:"flex-1 py-3 border-2 border-dashed rounded-xl font-bold text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:"Add Question"}),e.jsx(A,{onClick:xe,disabled:R,className:"flex-1 bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-500/30",children:R?"Processing...":"Review & Schedule"})]}),$&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4",children:e.jsxs(z,{className:"max-w-md w-full",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-purple-500"})," AI Question Generator"]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg border border-purple-200 dark:border-purple-800 mb-4 flex items-center gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-purple-800 dark:text-purple-200",children:"Try Before You Pay"}),e.jsx("p",{className:"text-[10px] text-purple-700 dark:text-purple-300",children:"First 2 generations are FREE. Then 5 Credits/use."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex bg-slate-100 dark:bg-slate-900 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>M("SCAN"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${b==="SCAN"?"bg-white dark:bg-slate-800 shadow text-blue-600":"text-slate-500"}`,children:"Scan Page"}),e.jsx("button",{onClick:()=>M("TOPIC"),className:`flex-1 py-2 text-xs font-bold rounded transition-all ${b==="TOPIC"?"bg-white dark:bg-slate-800 shadow text-blue-600":"text-slate-500"}`,children:"Topic"})]}),b==="TOPIC"&&e.jsx(C,{placeholder:"Enter Topic (e.g. Photosynthesis)",value:t,onChange:s=>l(s.target.value)}),b==="SCAN"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block p-4 border-2 border-dashed rounded-xl text-center cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-900 transition-colors",children:[e.jsx(be,{className:"mx-auto h-8 w-8 text-slate-400 mb-2"}),e.jsx("span",{className:"text-xs text-slate-500 font-bold block",children:"Take Photo / Upload"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:ue})]}),U.length>0&&e.jsxs("p",{className:"text-center text-xs text-green-500 font-bold",children:[U.length," images scanned"]})]}),e.jsx(A,{onClick:he,disabled:q,className:"w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white shadow-xl",children:q?"Processing...":"Generate Now"}),e.jsx("button",{onClick:()=>f(!1),className:"w-full text-xs text-slate-500 mt-2 hover:text-slate-700",children:"Cancel"})]})]})}),ee&&e.jsx(Ie,{imageSrc:ee,onCancel:()=>{X(null),f(!0)},onCrop:s=>{const o=new FileReader;o.readAsDataURL(s),o.onloadend=()=>{o.result&&(K(c=>[...c,o.result]),X(null),f(!0))}}})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Exams"}),e.jsxs(A,{onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"})," New Exam"]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[j.map(s=>{const o=new Date,c=new Date(s.startTime),d=new Date(s.endTime);let u="UPCOMING";return o>d?u="EXPIRED":o>=c&&(u="LIVE"),e.jsxs(z,{className:"relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(we,{className:"w-16 h-16"})}),e.jsx("h4",{className:"font-bold text-lg text-slate-800 dark:text-white",children:s.title}),e.jsxs("p",{className:"text-xs text-slate-500 mb-3",children:[s.questions.length," Questions â€¢ ",s.durationMinutes," Mins"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold px-2 py-1 rounded bg-slate-100 dark:bg-slate-800 text-slate-500",children:u==="UPCOMING"?new Date(s.startTime).toLocaleString():u}),u==="UPCOMING"&&e.jsx(ke,{targetDate:s.startTime})]})]},s.id)}),j.length===0&&e.jsx("div",{className:"col-span-full text-center py-10 text-slate-400",children:"No exams created yet."})]})]})};export{$e as default};
